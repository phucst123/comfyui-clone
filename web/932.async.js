"use strict";(self.webpackChunkgenerative_flow=self.webpackChunkgenerative_flow||[]).push([[932],{2972:function(Le,K,e){e.d(K,{Fh:function(){return j},aU:function(){return ge},bu:function(){return Se},u3:function(){return Z},wo:function(){return d}});var G=e(8305),D=e.n(G),te=e(6068),S=e.n(te),B=e(228),E=e.n(B),i=e(7999),P=e.n(i),y=e(8749),u=e(8772),ge=function(){var M=P()(E()().mark(function N(){return E()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,fetch((0,y.l9)("/object_info"));case 2:return I.abrupt("return",I.sent.json());case 3:case"end":return I.stop()}},N)}));return function(){return M.apply(this,arguments)}}(),d=function(){var M=P()(E()().mark(function N(){return E()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,fetch((0,y.l9)("/queue"));case 2:return I.abrupt("return",I.sent.json());case 3:case"end":return I.stop()}},N)}));return function(){return M.apply(this,arguments)}}(),Se=function(){var M=P()(E()().mark(function N(_){return E()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,fetch((0,y.l9)("/queue"),{method:"POST",body:JSON.stringify({delete:[_]})});case 2:case"end":return v.stop()}},N)}));return function(_){return M.apply(this,arguments)}}(),ce=null,Z=function(){var M=P()(E()().mark(function N(_){var I,v;return E()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,fetch((0,y.l9)("/prompt"),{method:"POST",body:JSON.stringify(_)});case 2:if(I=g.sent,I.status===200){g.next=9;break}return g.next=6,I.text();case 6:g.t0=g.sent,g.next=10;break;case 9:g.t0=void 0;case 10:return v=g.t0,g.abrupt("return",{error:v});case 12:case"end":return g.stop()}},N)}));return function(_){return M.apply(this,arguments)}}(),R=function M(N){var _=N.map(function(I){if(I.sourceHandle==="*"){var v=N.find(function(p){return p.target===I.source});return S()(S()({},I),{},{source:v.source,sourceHandle:v.sourceHandle})}return I});return _.find(function(I){return I.sourceHandle==="*"})?M(_):_.filter(function(I){return I.targetHandle!=="*"})},j=function(N){var _=N.graph,I=N.widgets,v=N.customWidgets,p=N.clientId,g={},W={};Object.entries(_.data).forEach(function(L){var ae=D()(L,2),J=ae[0],Q=ae[1];if(!v.includes(Q.value.widget)){var Ce=S()({},Q.value.fields);Object.entries(Ce).forEach(function(we){var Ee=D()(we,2),z=Ee[0],A=Ee[1],a=I[Q.value.widget].input.required[z];u.l.isInt(a)&&a[1].randomizable&&A===-1&&(Ce[z]=Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER))}),W[J]={position:Q.position,value:S()(S()({},Q.value),{},{fields:Ce})},g[J]={class_type:Q.value.widget,inputs:Ce}}});var V=R(_.connections);return console.log(V),V.forEach(function(L){var ae=_.data[L.source];if(ae){var J=I[ae.value.widget].output.findIndex(function(Q){return Q===L.sourceHandle});g[L.target]&&(g[L.target].inputs[L.targetHandle]=[L.source,J])}}),{prompt:g,client_id:p,extra_data:{extra_pnginfo:{workflow:{connections:V,data:W}}}}}},5600:function(Le,K,e){e.d(K,{i:function(){return ce}});var G=e(6068),D=e.n(G),te=e(4560),S=function(R,j){var M=te.Z.darkAlgorithm(R,j);return D()({},M)},B=function(R){var j={colorPrimary:"#3e6ae1",colorSuccess:"#0ca678",colorWarning:"#f59e0b",colorError:"#e11d48",colorInfo:"#4f46e5"},M={algorithm:[te.Z.compactAlgorithm],token:j};return R==="dark"&&(M.algorithm.push(S),M.token=D()(D()({},M.token),{},{colorPrimary:"#4f9bff",colorSuccess:"#34d399",colorWarning:"#fbbf24",colorError:"#f43f5e",colorInfo:"#818cf8"})),M},E=e(3563),i=e(906),P=e(8312),y=e(6622),u=e(9971),ge=e(5552),d=e(1527),Se=function(R){var j=(0,i.S)(),M=B(R),N={colorBgContainer:j==null?void 0:j.colorFillQuaternary,colorBorder:"transparent",controlHeightSM:24,controlOutline:"transparent"};return M.components={Input:N,InputNumber:N,Select:N,Tree:{colorBgContainer:void 0,controlHeightSM:24},TreeSelect:N},M},ce=function(R){var j=R.children,M=R.componentToken;(0,P.Us)({ThemeContext:u.Ni});var N=(0,E.q)(function(p){return{themeMode:p.themeMode}},ge.X),_=N.themeMode,I=_==="dark"?"dark":"light",v=Se(I);return M&&(v.components=D()(D()({},v.components),M)),(0,d.jsx)(y.f6,{theme:v,themeMode:_,children:j})}},7656:function(Le,K,e){e.d(K,{ZP:function(){return I}});var G=e(6068),D=e.n(G),te=e(7825),S=e.n(te),B=e(909),E=e(906),i=e(6622),P=e(4081),y=e(4412),u=e(5600),ge=e(3649),d=e.n(ge),Se,ce,Z,R=(0,i.kc)(function(v,p){var g=v.token,W=p.size,V=p.className,L=p.prefixCls,ae=typeof W=="number"?(0,i.iv)(Se||(Se=d()([`
          width: `,`px !important;
          height: `,`px !important;
        `])),W,W):"",J=(0,i.iv)(ce||(ce=d()([`
    display: flex;
    align-items: center;
    justify-content: center;

    &:hover {
      color: `,` !important;
    }
  `])),g.colorText);return{container:(0,i.cx)(L,J,ae,V),tooltip:(0,i.iv)(Z||(Z=d()([`
      pointer-events: none;
    `])))}}),j=e(1527),M=["placement","title","icon","cursor","onClick","className","size","prefixCls"],N=function(p){var g=p.placement,W=p.title,V=p.icon,L=p.cursor,ae=p.onClick,J=p.className,Q=p.size,Ce=p.prefixCls,we=S()(p,M),Ee=(0,B.k2)("actionicon",Ce),z=R({size:Q,prefixCls:Ee}),A=z.styles,a=(0,E.S)(),l=(0,j.jsx)(P.ZP,D()(D()({icon:V,className:(0,i.cx)(J,A.container),type:"text",style:{cursor:L},size:"small"},we),{},{onClick:ae}));return(0,j.jsx)(u.i,{componentToken:{Button:{colorText:a.colorTextTertiary,colorBgTextHover:a.colorFillSecondary,colorBgTextActive:a.colorFill}},children:W?(0,j.jsx)(y.Z,{showArrow:!1,align:{offset:[0,-5]},overlayClassName:A.tooltip,title:W,placement:g,children:l}):l})},_=N,I=_},4183:function(Le,K,e){e.d(K,{I:function(){return Z},K:function(){return j}});var G=e(6068),D=e.n(G),te=e(7825),S=e.n(te),B=e(3649),E=e.n(B),i=e(6622),P=e(4175),y=e(5600),u=e(1527),ge=["className"],d=["className"],Se,ce=(0,i.kc)(function(M){var N=M.stylish,_=M.css;return _(Se||(Se=E()([`
    `,`
  `])),N.controlContainer)}),Z=function(N){var _=N.className,I=S()(N,ge),v=ce(),p=v.styles,g=v.cx;return(0,u.jsx)(y.i,{children:(0,u.jsx)(P.Z,D()(D()({},I),{},{className:g(p,_)}))})},R=P.Z.TextArea,j=function(N){var _=N.className,I=S()(N,d),v=ce(),p=v.styles,g=v.cx;return(0,u.jsx)(y.i,{children:(0,u.jsx)(R,D()(D()({},I),{},{className:g(p,_)}))})}},3495:function(Le,K,e){e.d(K,{f:function(){return tn},Z:function(){return sn}});var G=e(8305),D=e.n(G),te=e(6068),S=e.n(te),B=e(4183),E=e(7656),i=e(1527),P=["","#f5222d","#fa541c","#fa8c16","#faad14","#fadb14","#a0d911","#52c41a","#13c2c2","#1677ff"],y=P.map(function(me,f){return{label:(0,i.jsx)("div",{style:{background:me||"#eee",width:16,height:16,borderRadius:"50%"}}),key:f}}),u=e(3563),ge=e(652),d=e(1867),Se=e(9249),ce=e(3098),Z=e(7094),R=e(5874),j=e(8829),M=e(6622),N=e(1503),_=e(959),I=e(500),v=e(5552),p=e(4231),g=e(8772),W=e(909),V=e(8749),L=e(524),ae=e(9817),J=function(f){var b=f.data,T=f.isHidden,h=(0,_.useRef)(null);(0,_.useEffect)(function(){h.current&&(console.log("NodeImgPreview",h.current),h.current.style.display=T?"none":"block"),console.log("NodeImgPreview",T)},[T]);var x=(0,_.useCallback)(function(H){var ee=H.image,_e=H.index;return(0,i.jsx)(L.Z,{height:"100%",src:(0,V.l9)(ae.Z.stringifyUrl({url:"/view",query:ee})),fallback:W.z2},_e)},[]);return!b||b.length===0?null:(0,i.jsx)("div",{ref:h,children:(0,i.jsx)(L.Z.PreviewGroup,{children:b.map(x).reverse()})})},Q=_.memo(J),Ce=e(2683),we=e(6052),Ee=e(1012),z=function(f){var b=f.label,T=f.type,h=f.position,x=f.slotType,H=f.isRequired,ee=(0,u.q)(function(F){return{nodes:F.nodes}},v.X),_e=ee.nodes,Oe=(0,_.useCallback)(function(F){if(F.targetHandle==="*"||F.sourceHandle==="*")return!0;try{var ne,oe=(ne=_e.find(function(U){return U.id===F.target}))===null||ne===void 0?void 0:ne.data.input.required[String(F.targetHandle)][0];(0,we.Z)(oe)&&(oe="STRING");var ue=F.sourceHandle;return oe===ue}catch(U){return!0}},[_e]);return(0,i.jsxs)(p.g7,{$position:h,$isRequired:H?1:0,children:[(0,i.jsx)(I.HH,{id:b,type:T,position:h,isValidConnection:Oe}),(0,i.jsx)("h5",{title:Array.isArray(x)?"STRING":x,style:{marginBottom:2},children:(0,Ee.Z)(b.toLowerCase())})]})},A=z,a=function(f){var b=f.data;return b!=null&&b.length?(0,i.jsx)(p.zw,{children:b.map(function(T){var h=T.name,x=T.type;return(0,i.jsx)(A,{slotType:x,label:h,type:"target",position:Ce.Ly.Left,isRequired:!0},h)})}):(0,i.jsx)("div",{})},l=_.memo(a),s=function(f){var b=f.data;return b!=null&&b.length?(0,i.jsx)(p.zw,{children:b.map(function(T){return(0,i.jsx)(A,{slotType:T,label:T,type:"source",position:Ce.Ly.Right,isRequired:!0},T)})}):(0,i.jsx)("div",{})},o=_.memo(s),t=e(6069),n=e(894),r=e(5558),m=e.n(r),C=e(3649),c=e.n(C),k=e(3209),se=e(5600),Y,Ae=(0,M.kc)(function(me){var f=me.css,b=me.stylish,T=me.prefixCls,h="".concat(T,"-select"),x=":not(.".concat(h,"-disabled):not(.").concat(h,"-customize-input)");return f(Y||(Y=c()([`
    &.`,` {
      &-multiple:not(&-customize-input) &.`,`-selector {
        `,`;
      }

      &`,` {
        &:hover {
          .`,`-selector {
            border-color: transparent;
            `,`;
          }
        }
      }

      &-focused`,` {
        &:hover {
          .`,`-selector {
            `,`;
          }
        }

        .`,`-selector {
          `,`;
        }
      }
    }

    .`,` {
      &-arrow {
        top: 13px;
        right: 8px;

        width: 10px;
        height: 10px;

        font-size: 10px;
      }
    }
  `])),h,h,b.controlContainer,x,h,b.controlContainer,x,h,b.controlContainerFocused,h,b.controlContainerFocused,h)}),De=function(f){var b=Ae(),T=b.styles,h=b.cx;return(0,i.jsx)(se.i,{children:(0,i.jsx)(k.Z,S()(S()({},f),{},{className:h(T,f.className)}))})},Te=e(512),Pe=e(4887),O=e(1359),he=function(f){var b=f.value,T=f.input,h=f.onChange,x=f.name,H=(0,_.useState)([]),ee=D()(H,2),_e=ee[0],Oe=ee[1],F=(0,u.q)(function(U){return U},v.X),ne=F.onRefresh,oe=F.widgets;(0,_.useEffect)(function(){var U,pe,re,Me=oe.LoadImage,Fe=x==="image"?Me==null||(U=Me.input)===null||U===void 0||(U=U.required)===null||U===void 0||(U=U.image)===null||U===void 0?void 0:U[0]:T==null?void 0:T[0],He=(pe=Fe==null?void 0:Fe.filter(function(fe){return!fe.includes("\\")}).map(function(fe){return{value:fe,label:fe}}))!==null&&pe!==void 0?pe:[],Ve=(re=Fe==null?void 0:Fe.filter(function(fe){return fe.includes("\\")}).reduce(function(fe,xe){var je=xe.split("\\"),Ke=D()(je,2),ye=Ke[0],Je=Ke[1];return fe[ye]||(fe[ye]=[]),fe[ye].push({value:xe,label:Je}),fe},{}))!==null&&re!==void 0?re:{},Be=[].concat(m()(He),m()(Object.entries(Ve).map(function(fe){var xe=D()(fe,2),je=xe[0],Ke=xe[1];return{label:je,options:Ke}})));Oe(Be)},[T,x,oe]);var ue=(0,_.useCallback)(function(U){var pe;U.file.status==="done"&&ne();var re=(pe=U.file.response)===null||pe===void 0?void 0:pe.name;re&&h(re)},[h,ne]);return(0,i.jsxs)(i.Fragment,{children:[x==="image"&&(0,i.jsx)(Pe.Z.Dragger,{accept:".png, .jpg, .jpeg, .webp",style:{margin:"8px 0"},itemRender:function(){return null},name:"image",action:function(){return(0,V.l9)("/upload/image")},maxCount:1,onChange:ue,children:(0,i.jsxs)(O.Z,{children:[(0,i.jsx)(Te.Z,{}),"Click or drag img to upload"]})}),(0,i.jsx)(De,{showSearch:!0,placeholder:"Search to Select",optionFilterProp:"children",filterOption:function(pe,re){var Me;return String((Me=re==null?void 0:re.label)!==null&&Me!==void 0?Me:"").toLowerCase().includes(pe.toLowerCase())},style:{width:"100%"},size:"small",value:b,defaultValue:T[0][0],onChange:h,options:_e})]})},w=_.memo(he),X=e(7825),be=e.n(X),ie=e(298),ve=["className"],le,$=(0,M.kc)(function(me){var f=me.stylish,b=me.css,T=me.token;return b(le||(le=c()([`
      `,`

      .`,`-input-number-group-addon {
        padding: 0 4px;
        color: `,`;
        background: `,`;
        border-color: transparent;
      }
    `])),f.controlContainer,W.xb,T.colorTextTertiary,T.colorFillQuaternary)}),Re=function(f){var b=f.className,T=be()(f,ve),h=$(),x=h.styles,H=h.cx;return(0,i.jsx)(se.i,{children:(0,i.jsx)(ie.Z,S()(S()({size:"small"},T),{},{className:H(x,b)}))})},Ne=e(9200),Ie=e(9971),q=Ie.ZP.div.withConfig({componentId:"sc-azuxda-0"})(["display:flex;"]),de=Ie.ZP.div.withConfig({componentId:"sc-azuxda-1"})(["display:flex;flex:",";align-items:center;justify-content:flex-start;> *{width:100%;}"],function(me){var f=me.span;return f}),We=function(f){var b=f.name,T=f.value,h=f.min,x=f.max,H=f.step,ee=f.style,_e=f.onChange,Oe=(0,u.q)(function(ye){return ye},v.X),F=Oe.counter,ne=(0,_.useState)(T),oe=D()(ne,2),ue=oe[0],U=oe[1],pe=(0,_.useState)(!1),re=D()(pe,2),Me=re[0],Fe=re[1],He=b==="seed",Ve=(0,_.useMemo)(function(){var ye=x,Je=h,Ye=H;switch(b){case"steps":x=200;break;case"cfg":x=32,H=.5;break;case"width":x=4096,h=512,H=4;break;case"height":x=4096,h=512,H=4;break;default:break}return{iMax:ye,iMin:Je,iStep:Ye}},[b,x,h,H]),Be=Ve.iMax,fe=Ve.iMin,xe=Ve.iStep,je=(0,_.useCallback)(function(ye){var Je,Ye=Number(ye!=null&&(Je=ye.target)!==null&&Je!==void 0&&Je.value?ye.target.value:ye);isNaN(Ye)||(U(Ye),_e(Ye))},[_e]),Ke=(0,_.useCallback)(function(ye){Fe(ye.target.checked)},[]);return(0,_.useEffect)(function(){!He||!Me||je(Math.floor(Math.random()*Be))},[F,Be]),(0,i.jsxs)(q,{style:ee,children:[(0,i.jsx)(de,{span:He?12:4,style:{marginRight:12},children:(0,i.jsx)(Re,{style:{width:"100%"},min:fe,max:Be,step:xe,value:Number(ue),onBlur:je,onPressEnter:je})}),(0,i.jsx)(de,{span:He?4:12,children:He?(0,i.jsx)(t.Z,{checked:Me,onChange:Ke,children:"Random"}):(0,i.jsx)(Ne.Z,{min:fe,max:Be,onChange:je,value:Number(ue),step:xe})})]})},Ue=_.memo(We),Qe=function(f){var b=f.id,T=f.name,h=f.input,x=(0,u.q)(function(Oe){var F;return{value:(F=Oe.graph[b])===null||F===void 0?void 0:F.fields[T],onChange:(0,n.Z)(function(ne){var oe;return Oe.onPropChange(b,T,ne!=null&&(oe=ne.target)!==null&&oe!==void 0&&oe.value?ne.target.value:ne)},100)}},v.X),H=x.value,ee=x.onChange;if(g.l.isList(h))return(0,i.jsx)(w,{value:H,name:T,input:h,onChange:ee});if(g.l.isBool(h))return(0,i.jsx)(t.Z,{value:H,defaultChecked:h[1].default,onChange:ee});if(g.l.isInt(h))return(0,i.jsx)(Ue,{name:T.toLowerCase(),style:{width:"100%"},value:Number(H!==null?H:h[1].default),max:Number(h[1].max),min:Number(h[1].min),onChange:function(F){var ne;return ee(Number(F!=null&&(ne=F.target)!==null&&ne!==void 0&&ne.value?F.target.value:F))}});if(g.l.isFloat(h))return(0,i.jsx)(Ue,{name:T.toLowerCase(),style:{width:"100%"},step:.01,value:Number(H!==null?H:h[1].default),max:Number(h[1].max),min:Number(h[1].min),onChange:function(F){var ne;return ee(Number(F!=null&&(ne=F.target)!==null&&ne!==void 0&&ne.value?F.target.value:F))}});if(g.l.isString(h)){var _e=h[1];return _e.multiline===!0?(0,i.jsx)(B.K,{style:{height:128,width:"100%"},defaultValue:H,onBlur:ee}):(0,i.jsx)(B.I,{style:{width:"100%"},value:H,onChange:ee})}return null},ze=_.memo(Qe),en=function(f){var b=f.data,T=f.nodeId,h=f.isHidden,x=(0,_.useRef)(null);return(0,_.useEffect)(function(){x.current&&(console.log("NodeParams",x.current),x.current.style.display=h?"none":"block"),console.log("NodeParams",h)},[h]),b!=null&&b.length?(0,i.jsx)("div",{ref:x,onClick:function(ee){return ee.stopPropagation()},children:b.map(function(H){var ee=H.name,_e=H.type,Oe=H.input;return(0,i.jsxs)("div",{children:[(0,i.jsx)(A,{slotType:_e,label:ee,type:"target",position:Ce.Ly.Left,isRequired:!1}),(0,i.jsx)(ze,{name:ee,id:T,input:Oe}),(0,i.jsx)("div",{style:{height:4}})]},ee)})}):null},nn=_.memo(en),on=function(f){var b=f.id,T=f.data,h=T.input,x=T.output,H=T.isHidden,ee=(0,u.q)(function(oe){var ue;return{imagePreviews:(ue=oe.graph)===null||ue===void 0||(ue=ue[b])===null||ue===void 0||(ue=ue.images)===null||ue===void 0?void 0:ue.map(function(U,pe){return{image:U,index:pe}}).filter(Boolean),inputImgPreviews:[{image:{filename:oe.onGetNodeFieldsData(b,"image"),type:"input"},index:0}].filter(function(U){return U.image.filename})}},v.X),_e=ee.imagePreviews,Oe=ee.inputImgPreviews,F=(0,_.useMemo)(function(){var oe=[];return Object.entries(h.required).forEach(function(ue){var U=D()(ue,2),pe=U[0],re=U[1];g.l.isParameterOrList(re)&&oe.push({name:pe,type:re[0],input:re})}),oe},[h]),ne=(0,_.useMemo)(function(){var oe=[];return Object.entries(h.required).forEach(function(ue){var U=D()(ue,2),pe=U[0],re=U[1];g.l.isParameterOrList(re)||oe.push({name:pe,type:re[0]})}),h.optional&&Object.entries(h.optional).forEach(function(ue){var U=D()(ue,2),pe=U[0],re=U[1];g.l.isParameterOrList(re)||oe.push({name:pe,type:re[0]})}),oe},[h]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(p.VA,{children:[(0,i.jsx)(l,{data:ne}),(0,i.jsx)(o,{data:x})]}),(0,i.jsx)(nn,{data:F,nodeId:b,isHidden:H}),(0,i.jsx)(Q,{data:_e||Oe,isHidden:H})]})},rn=_.memo(on),tn="sdNode",an=function(f){var b;console.log("NodeComponent",f.data.name),console.log("Node data",f);var T=(0,_.useRef)(null),h=(0,u.q)(function(Ge){var ke;return S()(S()({},Ge),{},{progressBar:((ke=Ge.nodeInProgress)===null||ke===void 0?void 0:ke.id)===f.id?Ge.nodeInProgress.progress:void 0})},v.X),x=h.progressBar,H=h.onDuplicateNode,ee=h.onDeleteNode,_e=h.onModifyChange,Oe=h.onToggleGroupChildren,F=(0,M.Fg)(),ne=(0,_.useState)(!1),oe=D()(ne,2),ue=oe[0],U=oe[1],pe=(0,_.useState)(f.data.isHidden),re=D()(pe,2),Me=re[0],Fe=re[1],He=x!==void 0,Ve=f.selected,Be=((b=f.data)===null||b===void 0?void 0:b.nickname)||f.data.name,fe=f.data.name==="Group",xe=f.id,je=function(ke){var Ze=ke.target.value;_e(f.id,"nickname",Ze),U(!1)},Ke=function(ke){var Ze=ke.key;_e(f.id,"color",P[Ze])},ye=function(ke){ke.stopPropagation(),ke.preventDefault();var Ze=!Me;Fe(Ze),_e(xe,"isHidden",Ze),fe&&Oe(xe,Ze)},Je=[{icon:(0,i.jsx)(ge.Z,{}),label:"Rename",key:"rename",onClick:function(){return U(!0)}},{icon:(0,i.jsx)(d.Z,{}),label:"Colors",key:"colors",children:y,onClick:Ke},{type:"divider"},{icon:(0,i.jsx)(Se.Z,{}),label:"Copy",key:"copy",onClick:function(){return H(f.id)}},{icon:(0,i.jsx)(ce.Z,{}),label:"Delete",key:"delete",onClick:function(){return ee(f.id)}}],Ye=fe?p.MW:p.OE,Xe;if(fe){var $e;Xe=($e=f.data)!==null&&$e!==void 0&&$e.color?(0,N.m4)(f.data.color,.2):F.colorFill}else{var qe;Xe=(qe=f.data)!==null&&qe!==void 0&&qe.color?(0,N.CD)(.8,F.colorBgContainer,f.data.color):F.colorBgContainer}return(0,i.jsxs)(Ye,{isHidden:Me,ref:T,size:"small",style:{background:Xe},title:ue?(0,i.jsx)(B.I,{autoFocus:!0,defaultValue:Be,onPressEnter:je,onBlur:je,size:"small",style:{margin:"4px 0",width:"100%"}}):Be,active:He||Ve?1:0,hoverable:!fe,extra:He?x>0&&(0,i.jsx)(j.Z,{steps:4,percent:Math.floor(x*100)}):(0,i.jsx)(E.ZP,{icon:Me?(0,i.jsx)(Z.Z,{}):(0,i.jsx)(R.Z,{}),onClick:ye,title:Me?"Maximize node":"Minimize node"}),children:[(0,i.jsx)(rn,S()(S()({},f),{},{data:S()(S()({},f.data),{},{isHidden:Me})})),Ve&&(0,i.jsx)(I.KP,{minWidth:80,minHeight:40})]})},sn=_.memo(an)},4231:function(Le,K,e){e.d(K,{MW:function(){return S},OE:function(){return te},VA:function(){return i},g7:function(){return B},zw:function(){return E}});var G=e(7380),D=e(9971),te=(0,D.ZP)(G.Z).withConfig({componentId:"sc-35fyyr-0"})(["min-width:80px;min-height:40px;box-shadow:",";opacity:",";",";.ant-card-head{height:15px;padding-right:3px;background:"," !important;border-bottom:unset;}"],function(P){var y=P.theme;return y.boxShadowTertiary},function(P){var y=P.isHidden;return y?.3:1},function(P){var y=P.active,u=P.theme;return y?(0,D.iv)(["outline:2px solid ",";"],u.colorPrimary):""},function(P){var y=P.theme;return y.colorFillQuaternary}),S=(0,D.ZP)(G.Z).withConfig({componentId:"sc-35fyyr-1"})(["min-width:80px;height:100%;min-height:120px;opacity:",";",";.react-flow__resize-control{pointer-events:all !important;}.ant-card-head{pointer-events:all !important;height:15px;padding-right:3px;background:"," !important;border-bottom:unset;}"],function(P){var y=P.isHidden;return y?.3:1},function(P){var y=P.active,u=P.theme;return y?(0,D.iv)(["outline:2px solid ",";"],u.colorPrimary):""},function(P){var y=P.theme;return y.colorFillQuaternary}),B=D.ZP.div.withConfig({componentId:"sc-35fyyr-2"})(["text-align:",";.react-flow__handle{top:unset;margin-top:10px;background:",";}"],function(P){var y=P.$position;return y},function(P){var y=P.$isRequired,u=P.theme;return y?u.colorPrimary:u.colorBorder}),E=D.ZP.div.withConfig({componentId:"sc-35fyyr-3"})(["flex:1;"]),i=D.ZP.div.withConfig({componentId:"sc-35fyyr-4"})(["display:flex;align-items:stretch;justify-content:stretch;width:100%;"])},909:function(Le,K,e){e.d(K,{k2:function(){return D},xb:function(){return G},z2:function(){return te}});var G="ant";function D(S,B){return B||(S?"".concat(G,"-").concat(S):G)}var te="data:image/webp;base64,UklGRnwFAABXRUJQVlA4WAoAAAAAAAAA/wEA/wEAVlA4IAgFAABQSACdASoAAgACAAAAJaW7hd2Eb84fxL/Fu2b+3YoPsf85/K75gdgO0n/cPKfeDJcf6jjA7zHCYHQ/3j/dfc97KfnX/r+4J/Mv6V/zesX+2XsH/p8mnzJ402iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iBvOWQB3qAPUMTgyeNNomNNomNNo/WuFENRaRU20KzdBk8abRMabRMabZptNKNjzbhNu1hd33Bk8abRMabRMaqb/Kw49SfJ6z/CJMabRMabRMabZmhIYfVFsmHjNZuDy16fMnjTaJjVTjPW0tTJZLHerBQmq0eatO2jHzJ402iY05WHL7+aif7qE1/IHlqJjp8yeNNomNNomOgT5lutenzJ402iY02iiNGPr6y16fMnjTaJjTV4XIBX7qr95uFey16fMnjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJh4AD+/+LjAAAAAAAAAAAC0rN37fkv7KNTSn+uqCrzce+ZFY+V2wLrwyvKnVnbWsbOXsdMkV78wpw6M5Ht0icrihssgqb5WJa130AMfeLeJ9cO1J09zwdzkLrF52YniIAf5by1ZJR0mRk5V3PL+ibKQy+xwP5TV+T4ump0K+LkZ+wBab78G4GSS/dSUn/muJIrSr1FKYQ2z+Oo/1cghL9BNsO6vmEYog/O+yhpCY29bMR0CXQYvzdg1F/tafnPHYkanS7zfqAUdz9T3liqmBomByf/0xab8CFnMjcUb+WakMeqRZmABEgjvkA0mKYwg38SWQh7/Vuo//EecvnIIU6s8PM/JtA563guvz/n96OwlyoBcJalNQg6XtTNvSAsoHYSMKv/MVt4tAew6OEoZPM7F0GglgJvJ9GZ1dQk/25kMpL351DoZAQ6rfvOizEs4ZuRe6hf/3HsGMMDbaPof/2ceBdX1Le/n4LtHkSExFcCQWXa/vLxe8xfHzvCfoWEH90DfhRSroCMjPo6VU/HbZqBX+ofhRw7+ZbW0v+jwjr24CaaKw0kd2zmn/hhn8Rqx/uUN9yZMB/pn3Bc8ThOFm7xZychuV93W7Q4q7IUHOFjTr3n4JuG+vn47m+DBSGXJL2jhcl0WB0cgW7Yw6xTQgWSBdJ67I/u/AKgIJTyPm2HzqrEx2sT5jp3uoehUB2ASMh4KwpBwVcIjeGYJ+/ICdC2AhxQiD5Rg7H2q+ggI00qhr0tQF9qrx2dAY2PwDASTq8cVMBwYpcMGadEMF7lQWxQv8sZ3YnQu0hWYSk6UE74i2ZSOL+0U4uWD5aUD92da9jCSaecnVKDk2U+mSLuEAAHPkRqknB/sBsy8YFWtSs0TSucCwKYBFVkOe0PikbUHR8/KX9OXKmcZgZDi4+9Phq53iAupQAAAAAAAAAAAAAAUFNBSU4AAAA4QklNA+0AAAAAABAASAAAAAEAAgBIAAAAAQACOEJJTQQoAAAAAAAMAAAAAj/wAAAAAAAAOEJJTQRDAAAAAAAOUGJlVwEQAAYAZAAAAAA="},9395:function(Le,K){var e={host:"localhost:8188",protocol:"http:"},G={host:"localhost:8188",protocol:"http:"},D=e;K.Z=D},7978:function(Le,K){var e={data:{"d6488046-7e3d-45ce-b0cb-fc461ded790d":{value:{widget:"VAELoader",fields:{vae_name:"vae-ft-mse-840000-ema-pruned.safetensors"},modify:{color:"#fadb14"}},position:{x:300,y:1200},width:319,height:120},"196c7067-dd8c-4b21-95bf-c7da1074359f":{value:{widget:"Group",fields:{},modify:{nickname:"Prompt"}},position:{x:300,y:1350},width:319,height:539},"2e19ea7c-a469-4aee-ba5f-50546f7b6856":{value:{widget:"PreviewImage",fields:{},images:[{filename:"ComfyUI_00015_.png",subfolder:"",type:"temp"}]},position:{x:1100,y:1e3},width:535,height:574},"2d69027b-18cb-4fba-a6f7-3cc6191da27a":{value:{widget:"EmptyLatentImage",fields:{width:512,height:512,batch_size:1},modify:{isHidden:!0}},position:{x:750,y:1150},width:240,height:246},"df10802c-dcb3-45cb-b61a-ed21c9435e54":{value:{widget:"VAEDecode",fields:{},modify:{isHidden:!0}},position:{x:750,y:1600},width:240,height:96},"3ab52db7-7835-409b-9742-cdbb84283789":{value:{widget:"KSampler",fields:{seed:0xb8ce6f395b97b000,steps:24,cfg:8,sampler_name:"dpm_2",scheduler:"normal",denoise:.99},modify:{isHidden:!0}},position:{x:750,y:1300},width:240,height:461},"03e009af-40ce-40f8-8678-ee811fe31f41":{value:{widget:"CLIPTextEncode",fields:{text:"low quality, distortion"},modify:{nickname:"Negative",color:"#fadb14"}},position:{x:19.384427793327575,y:280.91726159315385},width:280,height:228,parentId:"196c7067-dd8c-4b21-95bf-c7da1074359f"},"18d73b78-7fd7-4411-a39e-b8a17e677892":{value:{widget:"CLIPTextEncode",fields:{text:"a hyper sport car"},modify:{nickname:"Positive",color:"#fadb14"}},position:{x:20,y:40.91726159315385},width:278,height:154,parentId:"196c7067-dd8c-4b21-95bf-c7da1074359f"},"1ab1ba4a-5dfb-4ced-bc06-2b55af930969":{value:{widget:"CheckpointLoaderSimple",fields:{ckpt_name:"dreamshaper_8.safetensors"},modify:{color:"#fadb14"}},position:{x:300,y:1e3},width:317,height:148}},connections:[{source:"1ab1ba4a-5dfb-4ced-bc06-2b55af930969",sourceHandle:"MODEL",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"model"},{source:"1ab1ba4a-5dfb-4ced-bc06-2b55af930969",sourceHandle:"CLIP",target:"18d73b78-7fd7-4411-a39e-b8a17e677892",targetHandle:"clip"},{source:"1ab1ba4a-5dfb-4ced-bc06-2b55af930969",sourceHandle:"CLIP",target:"03e009af-40ce-40f8-8678-ee811fe31f41",targetHandle:"clip"},{source:"03e009af-40ce-40f8-8678-ee811fe31f41",sourceHandle:"CONDITIONING",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"negative"},{source:"18d73b78-7fd7-4411-a39e-b8a17e677892",sourceHandle:"CONDITIONING",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"positive"},{source:"2d69027b-18cb-4fba-a6f7-3cc6191da27a",sourceHandle:"LATENT",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"latent_image"},{source:"3ab52db7-7835-409b-9742-cdbb84283789",sourceHandle:"LATENT",target:"df10802c-dcb3-45cb-b61a-ed21c9435e54",targetHandle:"samples"},{source:"df10802c-dcb3-45cb-b61a-ed21c9435e54",sourceHandle:"IMAGE",target:"2e19ea7c-a469-4aee-ba5f-50546f7b6856",targetHandle:"images"},{source:"d6488046-7e3d-45ce-b0cb-fc461ded790d",sourceHandle:"VAE",target:"df10802c-dcb3-45cb-b61a-ed21c9435e54",targetHandle:"vae"}]};K.Z=e},3563:function(Le,K,e){e.d(K,{q:function(){return A}});var G=e(1759),D=e.n(G),te=e(8305),S=e.n(te),B=e(2092),E=e.n(B),i=e(5558),P=e.n(i),y=e(228),u=e.n(y),ge=e(6068),d=e.n(ge),Se=e(7999),ce=e.n(Se),Z=e(2972),R=e(1178),j=e(6987),M=e(6927),N=function(l){return l.class_type==="CLIPTextEncode"&&l.inputs.text!==void 0},_=function(l){return N(l)?[l.inputs.text]:[]},I=function(l,s){return l[3].client_id===s},v=function(){var a=ce()(u()().mark(function l(s){var o;return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,Z.wo)();case 2:return o=n.sent,n.abrupt("return",o.queue_running.concat(o.queue_pending).filter(function(r){return I(r,s)}).map(function(r){var m,C=r[1],c=r[2],k=Object.values(c),se=k.flatMap(_),Y=k.find(function(De){return De.class_type.startsWith("CheckpointLoader")}),Ae=Y==null||(m=Y.inputs)===null||m===void 0?void 0:m.ckpt_name;return{id:C,prompts:se,model:Ae}}));case 4:case"end":return n.stop()}},l)}));return function(s){return a.apply(this,arguments)}}(),p=e(255),g=e(8749),W=function(){var a=ce()(u()().mark(function l(){var s,o,t,n,r=arguments;return u()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:s=r.length>0&&r[0]!==void 0?r[0]:5e3,o=r.length>1&&r[1]!==void 0?r[1]:10,t=0;case 3:if(!(t<o)){C.next=21;break}return C.prev=4,C.next=7,p.Z.get((0,g.l9)("/history/123"));case 7:if(n=C.sent,n.status!==200){C.next=11;break}return console.log("Server is back online."),C.abrupt("return",!0);case 11:C.next=16;break;case 13:C.prev=13,C.t0=C.catch(4),console.log("Attempt ".concat(t+1,": Server still restarting..."));case 16:return t++,C.next=19,new Promise(function(c){return setTimeout(c,s)});case 19:C.next=3;break;case 21:return console.error("Server restart check timed out."),C.abrupt("return",!1);case 23:case"end":return C.stop()}},l,null,[[4,13]])}));return function(){return a.apply(this,arguments)}}(),V=null,L=e(500),ae=e(2448),J=e(8826),Q=e(2976),Ce=e(4597),we={Group:{input:{required:{}},output:[],output_name:[],name:"Group",category:"Utils"},Reroute:{input:{required:E()({},"*",["*"])},output:["*"],output_name:[],name:"Reroute",category:"Utils"}},Ee=we,z=e(5552),A=(0,Q.F)()((0,Ce.mW)(function(a,l){return{messages:[{content:[{text:"Welcome! I'm ready to help you reach out to desired workflows."}],sender:"bot"}],page:"flow",counter:0,workflowListUpdateCounter:0,widgets:{},customWidgets:Object.keys(Ee),graph:{},nodes:[],edges:[],queue:[],gallery:[],themeMode:"light",edgeType:"default",nodeInProgress:void 0,promptError:void 0,clientId:void 0,onSetPage:function(o){a({page:o},!1,"onSetPage")},onSetThemeMode:function(o){a({themeMode:o},!1,"onSetThemeMode")},onNewClientId:function(o){a({clientId:o},!1,"onNewClientId")},onRefresh:function(){var s=ce()(u()().mark(function t(){var n;return u()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,Z.aU)();case 2:n=m.sent,a({widgets:d()(d()({},Ee),n)},!1,"onRefresh");case 4:case"end":return m.stop()}},t)}));function o(){return s.apply(this,arguments)}return o}(),onInit:function(){var s=ce()(u()().mark(function t(){var n,r;return u()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return setInterval(function(){return l().onPersistTemp()},5e3),C.next=3,(0,Z.aU)();case 3:r=C.sent,a({widgets:d()(d()({},Ee),r)},!1,"onInit"),l().onLoadWorkflow((n=(0,R.Vj)())!==null&&n!==void 0?n:{data:{},connections:[]});case 6:case"end":return C.stop()}},t)}));function o(){return s.apply(this,arguments)}return o}(),onAddMessage:function(o){a(function(t){return{messages:[].concat(P()(t.messages),[o])}},!1,"onAddMessage")},onCreateGroup:function(){var o=l(),t=o.nodes,n=o.onDetachGroup,r=t.filter(function(Y){return Y.selected}).map(function(Y){return n(Y)});if(!(r.length<1)){var m=1/0,C=0,c=1/0,k=0;r.forEach(function(Y){var Ae=Y.position,De=Ae.x,Te=Ae.y,Pe=Y.width,O=Y.height;m=Math.min(m,De),C=Math.max(C,De+Number(Pe)),c=Math.min(c,Te),k=Math.max(k,Te+Number(O))});var se={widget:Ee.Group,position:{x:m-40,y:c-60},width:C-m+80,height:k-c+100,key:(0,ae.Z)()};a(function(Y){return(0,j.gz)(Y,se)},!1,"onCreateGroup")}},onSetNodesGroup:function(o,t){a(function(n){return{nodes:n.nodes.map(function(r){if(o.includes(r.id)){if(r.parentId===t.id)return r;r.parentId=t.id,r.position.x=r.position.x-t.position.x,r.position.y=r.position.y-t.position.y}else r.parentId===t.id&&(r.parentId=void 0,r.position.x=r.position.x+t.position.x,r.position.y=r.position.y+t.position.y);return r})}})},onDetachGroup:function(o){if(!o.parentId)return o;var t=l().nodes,n=t.find(function(r){return r.id===o.parentId});return d()(d()({},o),{},{parentId:void 0,position:{x:o.position.x+Number(n==null?void 0:n.position.x),y:o.position.y+Number(n==null?void 0:n.position.y)}})},onDetachNodesGroup:function(o,t){a(function(n){return{nodes:n.nodes.map(function(r){return o.includes(r.id)&&(r.parentId=void 0,r.position.x=r.position.x+t.position.x,r.position.y=r.position.y+t.position.y),r})}})},onNodesChange:function(o){a(function(t){return{nodes:(0,L.Fb)(o,t.nodes)}},!1,"onNodesChange")},onUpdateNodes:function(o,t){a(function(n){return{nodes:(0,j.tV)(o,t,n.nodes)}},!1,"onUpdateNodes")},onAddNode:function(o){a(function(t){return(0,j.gz)(t,o)},!1,"onAddNode")},onDeleteNode:function(o){var t=l().nodes,n=t.find(function(m){return m.id===o}),r=t.filter(function(m){return m.parentId===o}).map(function(m){return m.id});l().onDetachNodesGroup(r,n),a(function(m){return{nodes:(0,L.Fb)([{type:"remove",id:o}],m.nodes)}},!1,"onDeleteNode")},onDuplicateNode:function(o){a(function(t){var n=t.graph,r=t.nodes,m=t.widgets,C=n[o],c=r.find(function(Ae){return Ae.id===o}),k=c==null?void 0:c.position,se=k?d()(d()({},k),{},{y:k.y+(c.height||100)+24}):void 0,Y=d()(d()({widget:m[C.widget],node:C,position:se},(c==null?void 0:c.width)&&{width:c.width}),(c==null?void 0:c.height)&&{height:c.height});return(0,j.gz)(t,Y)},!1,"onDuplicateNode")},onNodeInProgress:function(o,t){a({nodeInProgress:{id:o,progress:t}},!1,"onNodeInProgress")},onPropChange:function(o,t,n){a(function(r){var m;r.onUpdateNodes(o,E()({},t,n));var C=d()(d()({},(m=r.graph[o])===null||m===void 0?void 0:m.fields),{},E()({},t,n)),c=d()(d()({},r.graph[o]),{},{fields:C}),k=d()(d()({},r.graph),{},E()({},o,c));return d()(d()({},r),{},{graph:k})},!1,"onPropChange")},onModifyChange:function(o,t,n){a(function(r){var m;r.onUpdateNodes(o,E()({},t,n));var C=d()(d()({},(m=r.graph[o])===null||m===void 0?void 0:m.modify),{},E()({},t,n)),c=d()(d()({},r.graph[o]),{},{modify:C}),k=d()(d()({},r.graph),{},E()({},o,c));return d()(d()({},r),{},{graph:k})},!1,"onModifyChange")},onGetNodeFieldsData:function(o,t){try{var n;return(n=l())===null||n===void 0||(n=n.graph[o])===null||n===void 0?void 0:n.fields[t]}catch(r){console.error(r)}},onCopyNode:function(){var o=l().nodes,t=o.filter(function(m){return m.selected}).map(function(m){return m.id}),n=(0,R.Mg)(l()),r={};return t.forEach(function(m){var C=n.data[m];if(C.parentId){var c=o.find(function(k){return k.id===C.parentId});r[m]=d()(d()({},C),{},{parentId:void 0,position:{x:C.position.x+Number(c==null?void 0:c.position.x),y:C.position.y+Number(c==null?void 0:c.position.y)}})}else r[m]=C}),n.data=r,n.connections=n.connections.filter(function(m){return t.includes(m.target)&&t.includes(m.source)}),n},onPasteNode:function(o,t){var n=(0,j.ug)(Object.values(o.data).map(function(se){return se.position})),r=(0,j.Xl)(o,n,t),m=r.data,C=r.idMap,c=(0,j.$V)(o,C),k=d()({data:m},c);a(function(se){return Object.entries(k.data).reduce(function(Y,Ae){var De=S()(Ae,2),Te=De[0],Pe=De[1],O=Y.widgets[Pe.value.widget];return O?(0,j.gz)(Y,{widget:O,node:Pe.value,position:Pe.position,width:Pe.width,height:Pe.height,parentId:Pe.parentId,key:Te}):(console.warn("Unknown widget ".concat(Pe.value.widget)),Y)},c.connections.reduce(M.H,se))},!0,"onPasteNode")},onEdgesChange:function(o){a({edges:(0,L.yn)(o,l().edges)},!1,"onEdgesChange")},onEdgesAnimate:function(o){a(function(t){return{edges:t.edges.map(function(n){return d()(d()({},n),{},{animated:o})})}},!1,"onEdgesAnimate")},onEdgesType:function(o){a(function(t){return{edges:t.edges.map(function(n){return d()(d()({},n),{},{type:o})})}},!1,"onEdgesType")},onConnect:function(o){a(function(t){return(0,M.H)(t,o)},!1,"onConnect")},onImageSave:function(o,t){a(function(n){return{gallery:n.gallery.concat(t.map(function(r){return{image:r}})),graph:d()(d()({},n.graph),{},E()({},o,d()(d()({},n.graph[o]),{},{images:t})))}},!1,"onImageSave")},onSubmit:function(){var s=ce()(u()().mark(function t(){var n,r,m;return u()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return n=l(),r=(0,R.Mg)(n),c.next=4,(0,Z.u3)((0,Z.Fh)({graph:r,widgets:n.widgets,customWidgets:n.customWidgets,clientId:n.clientId}));case 4:m=c.sent,a({promptError:m.error,counter:n.counter+1},!1,"onSubmit");case 6:case"end":return c.stop()}},t)}));function o(){return s.apply(this,arguments)}return o}(),onDeleteFromQueue:function(){var s=ce()(u()().mark(function t(n){return u()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,Z.bu)(n);case 2:return m.next=4,l().onQueueUpdate();case 4:case"end":return m.stop()}},t)}));function o(t){return s.apply(this,arguments)}return o}(),onQueueUpdate:function(){var s=ce()(u()().mark(function t(){return u()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=a,r.next=3,v(l().clientId);case 3:r.t1=r.sent,r.t2={queue:r.t1},(0,r.t0)(r.t2,!1,"onQueueUpdate");case 6:case"end":return r.stop()}},t)}));function o(){return s.apply(this,arguments)}return o}(),onPersistTemp:function(){(0,R.aA)((0,R.Mg)(l()))},onSaveLocalWorkFlow:function(o){(0,R.Eo)((0,R.Mg)(l()),o),a(function(t){return{workflowListUpdateCounter:t.workflowListUpdateCounter+1}},!1,"incrementWorkflowUpdateCounter")},onLoadLocalWorkflow:function(o){var t=(0,R._h)(o);t&&l().onLoadWorkflow(t)},onUpdateLocalWorkFlowGraph:function(o){(0,R.iq)(o,{graph:(0,R.Mg)(l())}),a(function(t){return{workflowListUpdateCounter:t.workflowListUpdateCounter+1}},!1,"incrementWorkflowUpdateCounter")},onUpdateLocalWorkFlowTitle:function(o,t){(0,R.iq)(o,{title:t}),a(function(n){return{workflowListUpdateCounter:n.workflowListUpdateCounter+1}},!1,"incrementWorkflowUpdateCounter")},onDeleteLocalWorkflow:function(o){(0,R.Sf)(o),a(function(t){return{workflowListUpdateCounter:t.workflowListUpdateCounter+1}},!1,"incrementWorkflowUpdateCounter")},onLoadWorkflow:function(){var s=ce()(u()().mark(function t(n){var r,m,C,c,k,se,Y,Ae,De,Te;return u()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return a({nodes:[],edges:[],counter:0,graph:{}},!1,"resetBeforeLoad"),O.prev=1,O.next=4,(0,Z.aU)();case 4:if(r=O.sent,a({widgets:d()(d()({},Ee),r)},!1,"onInit"),m=function(w){return!w||D()(w)!=="object"?!1:Object.values(w).every(function(X){return X&&D()(X)==="object"&&"class_type"in X&&"inputs"in X})},C=function(w){return w&&D()(w)==="object"&&"version"in w&&"nodes"in w&&"links"in w&&Array.isArray(w.nodes)&&Array.isArray(w.links)},!(0,R.TR)(n)){O.next=12;break}a(function(he){var w=d()(d()({},he),{},{nodes:[],edges:[],counter:0,graph:{}}),X=he.widgets;return Object.entries(n.data).forEach(function(be){var ie=S()(be,2),ve=ie[0],le=ie[1],$=X==null?void 0:X[le.value.widget];$?w=(0,j.gz)(w,{widget:$,node:le.value,position:le.position,width:le.width,height:le.height,key:ve,parentId:le.parentId}):console.warn("Unknown widget: ".concat(le.value.widget))}),n.connections.forEach(function(be){w=(0,M.H)(w,be)}),w},!1,"onLoadWorkflow-basic"),O.next=56;break;case 12:if(!m(n)){O.next=20;break}console.log("Loading ComfyUI API workflow"),c=n,k=2,Object.entries(c).forEach(function(he){var w,X=S()(he,2),be=X[0],ie=X[1],ve=(w=l().widgets)===null||w===void 0?void 0:w[ie.class_type];if(!ve){console.warn("Unknown widget: ".concat(ie.class_type));return}var le={widget:ie.class_type,fields:Object.fromEntries(Object.entries(ie.inputs).filter(function(q){var de=S()(q,2),We=de[0],Ue=de[1];return!Array.isArray(Ue)})),modify:ie.class_type.toLowerCase().includes("clip")||ie.class_type.toLowerCase().includes("load")?{color:"#fadb14"}:{}},$=Object.keys(c).indexOf(be),Re={x:$%5*350+150,y:Math.floor($/5)*450+150},Ne=300,Ie=200;a(function(q){return(0,j.gz)(q,{widget:ve,node:le,position:Re,width:Ne,height:Ie,key:be})},!1,"onLoadWorkflow-addNode-api")}),Object.entries(c).forEach(function(he){var w=S()(he,2),X=w[0],be=w[1];Object.entries(be.inputs).forEach(function(ie){var ve,le=S()(ie,2),$=le[0],Re=le[1];if(Array.isArray(Re)){var Ne=$,Ie=X,q=Re[0],de;if(((ve=c[q])===null||ve===void 0?void 0:ve.class_type)==="Reroute")de="*";else{var We,Ue,Qe=(We=l().widgets)===null||We===void 0?void 0:We[(Ue=c[q])===null||Ue===void 0?void 0:Ue.class_type];Qe&&Qe.output&&Qe.output[Re[1]]?de=Qe.output[Re[1]]:de="OUTPUT"}if(!de){console.warn("No valid source handle for node: ".concat(q,", output index: ").concat(Re[1],", skipping connection"));return}a(function(ze){return(0,M.H)(ze,{source:q,sourceHandle:de,target:Ie,targetHandle:Ne})},!1,"onLoadWorkflow-addConnection-api")}})}),O.next=56;break;case 20:if(!C(n)){O.next=55;break}return J.Z.info({content:"Installing nodes, please wait...",centered:!0,footer:null,width:400}),O.next=24,p.Z.post("http://".concat("localhost:8188","/install_node"),{workflow:n},{headers:{"Content-Type":"application/json"}});case 24:if(se=O.sent,se.status===200){O.next=27;break}throw new Error("Failed to install node");case 27:if(!se.data.restart){O.next=39;break}return J.Z.info({content:"Restarting Server...",centered:!0,footer:null,width:400}),O.prev=29,O.next=32,p.Z.get("http://".concat("localhost:8188","/manager/reboot"),{headers:{"Content-Type":"application/json"}});case 32:O.next=37;break;case 34:O.prev=34,O.t0=O.catch(29),console.log("Server reboot initiated");case 37:return O.next=39,new Promise(function(he){return setTimeout(he,5e3)});case 39:return O.next=41,W(5e3,20);case 41:if(Y=O.sent,Y){O.next=44;break}throw new Error("Server is not responding");case 44:return J.Z.destroyAll(),O.next=47,(0,Z.aU)();case 47:Ae=O.sent,a({widgets:d()(d()({},Ee),Ae)},!1,"onInit"),De=1.5,Te=(0,R.Pt)(n,l().widgets),Object.entries(Te).forEach(function(he){var w,X=S()(he,2),be=X[0],ie=X[1],ve=(w=l().widgets)===null||w===void 0?void 0:w[ie.class_type];if(!ve){console.warn("Unknown widget: ".concat(ie.class_type));return}var le={widget:ie.class_type,fields:Object.fromEntries(Object.entries(ie.inputs).filter(function(q){var de=S()(q,2),We=de[0],Ue=de[1];return!Array.isArray(Ue)})),modify:ie.class_type.toLowerCase().includes("clip")||ie.class_type.toLowerCase().includes("load")?{color:"#fadb14"}:{}},$=n.nodes.find(function(q){return q.id.toString()===be}),Re={x:$?$.pos[0]*De:0,y:$?$.pos[1]*De:0},Ne=$?$.size[0]:400,Ie=$?$.size[1]:400;a(function(q){return(0,j.gz)(q,{widget:ve,node:le,position:Re,width:Ne,height:Ie,key:be})},!1,"onLoadWorkflow-addNode-ui")}),Object.entries(Te).forEach(function(he){var w=S()(he,2),X=w[0],be=w[1];Object.entries(be.inputs).forEach(function(ie){var ve=S()(ie,2),le=ve[0],$=ve[1];if(Array.isArray($)){var Re=le,Ne=X,Ie=$[0],q;if(Te[Ie].class_type==="Reroute")q="*";else{var de,We=n.nodes.find(function(Ue){return Ue.id.toString()===Ie});q=We==null||(de=We.outputs)===null||de===void 0||(de=de[$[1]])===null||de===void 0?void 0:de.type}if(!q){console.warn("No valid source handle for node: ".concat(Ie,", output index: ").concat($[1],", skipping connection"));return}a(function(Ue){return(0,M.H)(Ue,{source:Ie,sourceHandle:q,target:Ne,targetHandle:Re})},!1,"onLoadWorkflow-addConnection-ui")}})}),O.next=56;break;case 55:throw new Error("Unknown workflow format. Supported formats: Persisted Graph, ComfyUI API workflow, ComfyUI UI workflow");case 56:console.log("Workflow loaded successfully"),O.next=64;break;case 59:O.prev=59,O.t1=O.catch(1),J.Z.destroyAll(),console.error("Workflow loading failed:",O.t1),J.Z.error({content:O.t1 instanceof Error&&O.t1.message?O.t1.message:"Failed to load workflow",centered:!0,footer:null,width:400});case 64:case"end":return O.stop()}},t,null,[[1,59],[29,34]])}));function o(t){return s.apply(this,arguments)}return o}(),onDownloadWorkflow:function(){(0,R.Cq)((0,R.Mg)(l()))},onToggleGroupChildren:function(o,t){a(function(n){var r=t?.3:1,m=n.nodes.map(function(c){return c.parentId===o?d()(d()({},c),{},{data:d()(d()({},c.data),{},{isHidden:t,opacity:r}),style:d()(d()({},c.style),{},{opacity:r})}):c}),C=d()({},n.graph);return Object.keys(C).forEach(function(c){var k=n.nodes.find(function(Y){return Y.id===c});if(k&&k.parentId===o){var se;C[c]=d()(d()({},C[c]),{},{modify:d()(d()({},(se=C[c])===null||se===void 0?void 0:se.modify),{},{opacity:r,isHidden:t})})}}),d()(d()({},n),{},{nodes:m,graph:C})},!1,"onToggleGroupChildren")}}}),z.X)},6927:function(Le,K,e){e.d(K,{H:function(){return S},g:function(){return B}});var G=e(6068),D=e.n(G),te=e(2683),S=function(i,P){var y=i.edges,u=P.targetHandle,ge=P.target;return D()(D()({},i),{},{edges:(0,te.Z_)(P,y.filter(function(d){return!(d.targetHandle===u&&d.target===ge)}))})},B=function(i){return i.edges.flatMap(function(P){var y=P.source,u=P.sourceHandle,ge=P.target,d=P.targetHandle;return u!=null&&u.length&&d!==null&&d!==void 0&&d.length?[{source:y,sourceHandle:u,target:ge,targetHandle:d}]:[]})}},8749:function(Le,K,e){e.d(K,{l9:function(){return D}});var G=e(9395),D=function(S){return"".concat(G.Z.protocol,"//").concat(G.Z.host).concat(S)}},8772:function(Le,K,e){e.d(K,{l:function(){return i}});var G=e(5298),D=e.n(G),te=e(7069),S=e.n(te),B=e(6052),E=function(){function P(){D()(this,P)}return S()(P,[{key:"isBool",value:function(u){return(0,B.Z)(u)?u[0]==="BOOLEAN":!1}},{key:"isInt",value:function(u){return(0,B.Z)(u)?u[0]==="INT":!1}},{key:"isFloat",value:function(u){return(0,B.Z)(u)?u[0]==="FLOAT":!1}},{key:"isString",value:function(u){return(0,B.Z)(u)?u[0]==="STRING":!1}},{key:"isList",value:function(u){return(0,B.Z)(u)?Array.isArray(u[0]):!1}},{key:"isParameterOrList",value:function(u){return(0,B.Z)(u)?this.isBool(u)||this.isInt(u)||this.isFloat(u)||this.isString(u)||this.isList(u):!1}}]),P}(),i=new E},6987:function(Le,K,e){e.d(K,{gz:function(){return Se},$V:function(){return _},Xl:function(){return N},yY:function(){return Z},rf:function(){return R},ug:function(){return j},tV:function(){return ce}});var G=e(8305),D=e.n(G),te=e(2092),S=e.n(te),B=e(6068),E=e.n(B),i=e(3495),P=e(500),y=e(2448),u=e(8772),ge=function(v){var p={};return Object.entries(v.input.required).forEach(function(g){var W=D()(g,2),V=W[0],L=W[1];if(u.l.isBool(L)){var ae;p[V]=(ae=L[1].default)!==null&&ae!==void 0?ae:!1}else if(u.l.isFloat(L)){var J;p[V]=(J=L[1].default)!==null&&J!==void 0?J:0}else if(u.l.isInt(L)){var Q;p[V]=(Q=L[1].default)!==null&&Q!==void 0?Q:0}else u.l.isString(L)?p[V]="":u.l.isList(L)&&(p[V]=L[0][0])}),p},d=function(v){return{widget:v.name,fields:ge(v)}},Se=function(v,p){var g,W=p.widget,V=p.node,L=p.position,ae=L===void 0?{x:0,y:0}:L,J=p.width,Q=p.height,Ce=p.key,we=p.parentId,Ee=String(Ce!=null?Ce:(0,y.Z)()),z=v.nodes.map(function(a){var l;return(l=a.zIndex)!==null&&l!==void 0?l:0}).concat([0]).reduce(function(a,l){return Math.max(a,l)})+1,A={id:Ee,type:i.f,data:E()(E()({},W),(g=V==null?void 0:V.modify)!==null&&g!==void 0?g:{}),dragHandle:".ant-card-head",position:ae,zIndex:z,width:J,height:Q,parentId:we,style:{width:J,height:Q}};return E()(E()({},v),{},{nodes:(0,P.Fb)([{type:"add",item:A}],v.nodes),graph:E()(E()({},v.graph),{},S()({},Ee,V!=null?V:d(W)))})},ce=function(v,p,g){return g.map(function(W){return W.id===v&&(W.data=E()(E()({},W.data),p)),W})},Z=function(v,p,g){return g.screenToFlowPosition({x:v,y:p})},R=function(v,p){var g=p.getViewport(),W=g.x,V=g.y,L=g.zoom,ae=v.current.offsetWidth,J=v.current.offsetHeight;return{x:Math.floor((ae/2-W)/L),y:Math.floor((J/2-V)/L)}},j=function(v){for(var p=v[0],g=1;g<v.length;g++){var W=v[g];(W.x<p.x||W.x===p.x&&W.y<p.y)&&(p=W)}return p},M=function(v,p,g){return E()(E()({},v),{},{position:{x:Math.floor(v.position.x-p.x+g.x),y:Math.floor(v.position.y-p.y+g.y)},key:(0,y.Z)()})},N=function(v,p,g){return Object.entries(v.data).reduce(function(W,V){var L=D()(V,2),ae=L[0],J=L[1],Q=M(J,p,g);return{data:E()(E()({},W.data),{},S()({},Q.key,Q)),idMap:E()(E()({},W.idMap),{},S()({},ae,Q.key))}},{data:{},idMap:{}})},_=function(v,p){return{connections:v.connections.map(function(g){return E()(E()({},g),{},{source:p[g.source],target:p[g.target]})})}}},1178:function(Le,K,e){e.d(K,{Cq:function(){return ae},Eo:function(){return W},Mg:function(){return j},Pt:function(){return we},Sf:function(){return g},Sk:function(){return L},TR:function(){return J},Vj:function(){return N},W:function(){return M},_h:function(){return p},aA:function(){return _},iq:function(){return V},qW:function(){return v}});var G=e(8305),D=e.n(G),te=e(335),S=e.n(te),B=e(1759),E=e.n(B),i=e(228),P=e.n(i),y=e(7999),u=e.n(y),ge=e(6068),d=e.n(ge),Se=e(6927),ce=e(7978),Z="kitchen-flow-temp",R="kitchen-flow-local",j=function(A){var a={};return A.nodes.forEach(function(l){var s=A.graph[l.id];s!==void 0&&(a[l.id]={value:s,position:l.position},l.width&&(a[l.id].width=l.width),l.height&&(a[l.id].height=l.height),l.parentId&&(a[l.id].parentId=l.parentId))}),{data:a,connections:(0,Se.g)(A)}},M=function(){try{localStorage.removeItem(Z)}catch(A){console.log("[cleanTempWorkflow]",A)}},N=function(){var A=localStorage.getItem(Z);return A?JSON.parse(A):ce.Z},_=function(A){try{localStorage.setItem(Z,JSON.stringify(A))}catch(a){console.log("[saveTempWorkflow]",a)}},I=function(){try{localStorage.removeItem(R)}catch(A){console.log("[cleanLocalWorkflows]",A)}},v=function(){try{var A=localStorage.getItem(R);return A?JSON.parse(A):[]}catch(a){return console.log("[retrieveLocalWorkflows]",a),[]}},p=function(A){var a=v(),l=a.find(function(s){return s.id===A});return l?l.graph:null},g=function(A){try{var a=v().map(function(l){return l.id!==A?l:!1}).filter(Boolean);localStorage.setItem(R,JSON.stringify(a))}catch(l){console.log("[deleteLocalWorkflowFromId]",l)}},W=function(A,a){try{var l=v(),s=new Date().getTime();l.push({title:a||"Local-".concat(s),time:s,id:"kitchen-".concat(s,"-").concat(Math.floor(Math.random()*1e6)),graph:A}),localStorage.setItem(R,JSON.stringify(l))}catch(o){console.log("[saveLocalWorkflow]",o)}},V=function(A,a){try{var l=v().map(function(s){return s.id!==A?s:d()(d()(d()({},s),a),{},{time:new Date().getTime()})});localStorage.setItem(R,JSON.stringify(l))}catch(s){console.log("[updateLocalWorkflow]",s)}},L=function(){var z=u()(P()().mark(function A(a,l){var s,o;return P()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,s=new FileReader,!a){n.next=9;break}return s.readAsText(a),n.next=6,new Promise(function(r,m){s.addEventListener("load",function(C){var c,k=(c=C.target)===null||c===void 0?void 0:c.result;typeof k=="string"?r(k):m(new Error("Failed to read file"))}),s.addEventListener("error",function(){m(new Error("Error reading file"))})});case 6:return o=n.sent,n.next=9,l(JSON.parse(o));case 9:n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),console.log("[readWorkflowFromFile]",n.t0);case 14:case"end":return n.stop()}},A,null,[[0,11]])}));return function(a,l){return z.apply(this,arguments)}}(),ae=function(A,a){var l=new Blob([JSON.stringify(A)],{type:"application/json"}),s=URL.createObjectURL(l),o=document.createElement("a");o.download=a?"".concat(a,".json"):"workflow.json",o.href=s,o.click(),URL.revokeObjectURL(s)},J=function(A){return A!==null&&E()(A)==="object"&&"data"in A&&"connections"in A&&E()(A.data)==="object"&&Array.isArray(A.connections)},Q=["fixed","increment","decrement","randomize"],Ce=function(A,a){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(a==="Note")return{note:["STRING"]};var s=A[a];if(!s)return null;if(l)return s[l]||null;var o=s.input;return d()(d()({},o.required),o.optional)},we=function(A,a){var l=A.version,s=A.nodes,o=A.links;if(!(l&&s&&o))return A;if(!a)throw new Error("An active ComfyUI connection is required to convert a UI workflow file.");var t={},n=S()(s),r;try{for(n.s();!(r=n.n()).done;){var m=r.value;m.type==="PrimitiveNode"&&(t[m.id]=m.widgets_values[0])}}catch(Ne){n.e(Ne)}finally{n.f()}var C={},c=S()(s),k;try{for(c.s();!(k=c.n()).done;){var se=k.value,Y=se.id,Ae=se.type;if(Ae!=="PrimitiveNode"){var De={},Te=Ce(a,Ae);if(console.log("fields",Te),!Te)throw new Error("Workflow uses node type ".concat(Ae,", but it is not installed on the ComfyUI server."));for(var Pe=0,O=0,he=Object.entries(Te);O<he.length;O++){var w=D()(he[O],2),X=w[0],be=w[1],ie=be[0];if(["INT","FLOAT","BOOL","BOOLEAN","STRING"].includes(ie)||Array.isArray(ie)){var ve=se.widgets_values;De[X]=ve[Pe],Pe+=1,ve.length>Pe&&Q.includes(ve[Pe])&&(Pe+=1)}var le=S()(se.inputs||[]),$;try{var Re=function(){var Ie=$.value;if(Ie.name===X&&Ie.link!==null||Ie.name===""&&X==="*"){var q=o.find(function(We){return We[0]===Ie.link});if(q){var de=t[q[1]];de!==void 0?De[X]=de:De[X]=[String(q[1]),q[2]]}return 1}};for(le.s();!($=le.n()).done&&!Re(););}catch(Ne){le.e(Ne)}finally{le.f()}}C[Y]={class_type:Ae,inputs:De}}}}catch(Ne){c.e(Ne)}finally{c.f()}return console.log("workflow",C),C},Ee=function(A,a){var l=A.version,s=A.nodes,o=A.links;if(!(l&&s&&o))return A;if(!a)throw new Error("An active ComfyUI connection is required to convert a UI workflow file.");var t=[],n=_createForOfIteratorHelper(s),r;try{for(n.s();!(r=n.n()).done;){var m=r.value,C=m.id,c=m.type;c!=="PrimitiveNode"&&(a[c]||t.push(c))}}catch(k){n.e(k)}finally{n.f()}return t}}}]);
