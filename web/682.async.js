"use strict";(self.webpackChunkgenerative_flow=self.webpackChunkgenerative_flow||[]).push([[682],{1794:function(ye,G,e){e.d(G,{Fh:function(){return E},aU:function(){return me},bu:function(){return pe},u3:function(){return V},wo:function(){return w}});var B=e(8305),C=e.n(B),$=e(6068),S=e.n($),U=e(228),o=e.n(U),q=e(7999),c=e.n(q),A=e(4565),i=e(6952),me=function(){var R=c()(o()().mark(function y(){return o()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,fetch((0,A.l9)("/object_info"));case 2:return v.abrupt("return",v.sent.json());case 3:case"end":return v.stop()}},y)}));return function(){return R.apply(this,arguments)}}(),w=function(){var R=c()(o()().mark(function y(){return o()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,fetch((0,A.l9)("/queue"));case 2:return v.abrupt("return",v.sent.json());case 3:case"end":return v.stop()}},y)}));return function(){return R.apply(this,arguments)}}(),pe=function(){var R=c()(o()().mark(function y(I){return o()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,fetch((0,A.l9)("/queue"),{method:"POST",body:JSON.stringify({delete:[I]})});case 2:case"end":return _.stop()}},y)}));return function(I){return R.apply(this,arguments)}}(),J=null,V=function(){var R=c()(o()().mark(function y(I){var v,_;return o()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,fetch((0,A.l9)("/prompt"),{method:"POST",body:JSON.stringify(I)});case 2:if(v=f.sent,v.status===200){f.next=9;break}return f.next=6,v.text();case 6:f.t0=f.sent,f.next=10;break;case 9:f.t0=void 0;case 10:return _=f.t0,f.abrupt("return",{error:_});case 12:case"end":return f.stop()}},y)}));return function(I){return R.apply(this,arguments)}}(),ee=function R(y){var I=y.map(function(v){if(v.sourceHandle==="*"){var _=y.find(function(P){return P.target===v.source});return S()(S()({},v),{},{source:_.source,sourceHandle:_.sourceHandle})}return v});return I.find(function(v){return v.sourceHandle==="*"})?R(I):I.filter(function(v){return v.targetHandle!=="*"})},E=function(y){var I=y.graph,v=y.widgets,_=y.customWidgets,P=y.clientId,f={},L={};Object.entries(I.data).forEach(function(O){var ne=C()(O,2),re=ne[0],Z=ne[1];if(!_.includes(Z.value.widget)){var ge=S()({},Z.value.fields);Object.entries(ge).forEach(function(Ee){var Oe=C()(Ee,2),u=Oe[0],d=Oe[1],s=v[Z.value.widget].input.required[u];i.l.isInt(s)&&s[1].randomizable&&d===-1&&(ge[u]=Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER))}),L[re]={position:Z.position,value:S()(S()({},Z.value),{},{fields:ge})},f[re]={class_type:Z.value.widget,inputs:ge}}});var K=ee(I.connections);return console.log(K),K.forEach(function(O){var ne=I.data[O.source];if(ne){var re=v[ne.value.widget].output.findIndex(function(Z){return Z===O.sourceHandle});f[O.target]&&(f[O.target].inputs[O.targetHandle]=[O.source,re])}}),{prompt:f,client_id:P,extra_data:{extra_pnginfo:{workflow:{connections:K,data:L}}}}}},3592:function(ye,G,e){e.d(G,{i:function(){return V}});var B=e(6068),C=e.n(B),$=e(4560),S=function(E,R){var y=$.Z.darkAlgorithm(E,R);return C()({},y)},U=function(E){var R={algorithm:[$.Z.compactAlgorithm]};return E==="dark"&&R.algorithm.push(S),R},o=e(5910),q=e(5955),c=e(7854),A=e(4860),i=e(1263),me=e(7298),w=e(8200),pe=e(1527),J=function(E){var R=(0,q.S)(),y=U(E),I={colorBgContainer:R==null?void 0:R.colorFillQuaternary,colorBorder:"transparent",controlHeightSM:24,controlOutline:"transparent"};return y.components={Input:I,InputNumber:I,Select:I,Tree:{colorBgContainer:void 0,controlHeightSM:24},TreeSelect:I},y},V=function(E){var R=E.children,y=E.componentToken;(0,c.Us)({ThemeContext:me.Ni});var I=(0,o.q)(function(L){return{themeMode:L.themeMode}},w.X),v=I.themeMode,_=(0,A.r)(),P=_.appearance,f=J(P);return y&&(f.components=C()(C()({},f.components),y)),(0,pe.jsx)(i.f6,{theme:f,themeMode:v,children:R})}},4434:function(ye,G,e){e.d(G,{I:function(){return V},K:function(){return E}});var B=e(6068),C=e.n(B),$=e(7825),S=e.n($),U=e(3649),o=e.n(U),q=e(1263),c=e(1534),A=e(3592),i=e(1527),me=["className"],w=["className"],pe,J=(0,q.kc)(function(R){var y=R.stylish,I=R.css;return I(pe||(pe=o()([`
    `,`
  `])),y.controlContainer)}),V=function(y){var I=y.className,v=S()(y,me),_=J(),P=_.styles,f=_.cx;return(0,i.jsx)(A.i,{children:(0,i.jsx)(c.Z,C()(C()({},v),{},{className:f(P,I)}))})},ee=c.Z.TextArea,E=function(y){var I=y.className,v=S()(y,w),_=J(),P=_.styles,f=_.cx;return(0,i.jsx)(A.i,{children:(0,i.jsx)(ee,C()(C()({},v),{},{className:f(P,I)}))})}},5762:function(ye,G,e){e.d(G,{f:function(){return Ye},Z:function(){return Xe}});var B=e(8305),C=e.n(B),$=e(6068),S=e.n($),U=e(4434),o=e(1527),q=["","#f5222d","#fa541c","#fa8c16","#faad14","#fadb14","#a0d911","#52c41a","#13c2c2","#1677ff"],c=q.map(function(te,l){return{label:(0,o.jsx)("div",{style:{background:te||"#eee",width:16,height:16,borderRadius:"50%"}}),key:l}}),A=e(5910),i=e(5135),me=e(2806),w=e(434),pe=e(346),J=e(4528),V=e(1263),ee=e(8314),E=e(959),R=e(2508),y=e(8200),I=e(262),v=e(6952),_=e(520),P=e(4565),f=e(2473),L=e(7467),K=function(l){var D=l.data,b=(0,E.useCallback)(function(g){var T=g.image,F=g.index;return(0,o.jsx)(f.Z,{height:"100%",src:(0,P.l9)(L.Z.stringifyUrl({url:"/view",query:T})),fallback:_.z2},F)},[]);return!D||D.length===0?null:(0,o.jsx)(f.Z.PreviewGroup,{children:D.map(b).reverse()})},O=E.memo(K),ne=e(1158),re=e(6052),Z=e(1012),ge=function(l){var D=l.label,b=l.type,g=l.position,T=l.slotType,F=l.isRequired,ce=(0,A.q)(function(W){return{nodes:W.nodes}},y.X),Pe=ce.nodes,ve=(0,E.useCallback)(function(W){if(W.targetHandle==="*"||W.sourceHandle==="*")return!0;try{var N,H=(N=Pe.find(function(x){return x.id===W.target}))===null||N===void 0?void 0:N.data.input.required[String(W.targetHandle)][0];(0,re.Z)(H)&&(H="STRING");var ue=W.sourceHandle;return H===ue}catch(x){return!0}},[Pe]);return(0,o.jsxs)(I.g7,{$position:g,$isRequired:F?1:0,children:[(0,o.jsx)(R.HH,{id:D,type:b,position:g,isValidConnection:ve}),(0,o.jsx)("h5",{title:Array.isArray(T)?"STRING":T,style:{marginBottom:2},children:(0,Z.Z)(D.toLowerCase())})]})},Ee=ge,Oe=function(l){var D=l.data;return D!=null&&D.length?(0,o.jsx)(I.zw,{children:D.map(function(b){var g=b.name,T=b.type;return(0,o.jsx)(Ee,{slotType:T,label:g,type:"target",position:ne.Ly.Left,isRequired:!0},g)})}):(0,o.jsx)("div",{})},u=E.memo(Oe),d=function(l){var D=l.data;return D!=null&&D.length?(0,o.jsx)(I.zw,{children:D.map(function(b){return(0,o.jsx)(Ee,{slotType:b,label:b,type:"source",position:ne.Ly.Right,isRequired:!0},b)})}):(0,o.jsx)("div",{})},s=E.memo(d),n=e(4619),t=e(8429),r=e(5558),a=e.n(r),p=e(3649),m=e.n(p),h=e(1800),k=e(3592),M,j=(0,V.kc)(function(te){var l=te.css,D=te.stylish,b=te.prefixCls,g="".concat(b,"-select"),T=":not(.".concat(g,"-disabled):not(.").concat(g,"-customize-input)");return l(M||(M=m()([`
    &.`,` {
      &-multiple:not(&-customize-input) &.`,`-selector {
        `,`;
      }

      &`,` {
        &:hover {
          .`,`-selector {
            border-color: transparent;
            `,`;
          }
        }
      }

      &-focused`,` {
        &:hover {
          .`,`-selector {
            `,`;
          }
        }

        .`,`-selector {
          `,`;
        }
      }
    }

    .`,` {
      &-arrow {
        top: 13px;
        right: 8px;

        width: 10px;
        height: 10px;

        font-size: 10px;
      }
    }
  `])),g,g,D.controlContainer,T,g,D.controlContainer,T,g,D.controlContainerFocused,g,D.controlContainerFocused,g)}),z=function(l){var D=j(),b=D.styles,g=D.cx;return(0,o.jsx)(k.i,{children:(0,o.jsx)(h.Z,S()(S()({},l),{},{className:g(b,l.className)}))})},se=e(5636),ae=e(4194),Q=e(1359),oe=function(l){var D=l.value,b=l.input,g=l.onChange,T=l.name,F=(0,E.useState)([]),ce=C()(F,2),Pe=ce[0],ve=ce[1],W=(0,A.q)(function(x){return x},y.X),N=W.onRefresh,H=W.widgets;(0,E.useEffect)(function(){var x,ie,fe,Ce=H.LoadImage,Ie=T==="image"?Ce==null||(x=Ce.input)===null||x===void 0||(x=x.required)===null||x===void 0||(x=x.image)===null||x===void 0?void 0:x[0]:b==null?void 0:b[0],Me=(ie=Ie==null?void 0:Ie.filter(function(de){return!de.includes("\\")}).map(function(de){return{value:de,label:de}}))!==null&&ie!==void 0?ie:[],Ue=(fe=Ie==null?void 0:Ie.filter(function(de){return de.includes("\\")}).reduce(function(de,Ae){var Se=Ae.split("\\"),_e=C()(Se,2),Y=_e[0],be=_e[1];return de[Y]||(de[Y]=[]),de[Y].push({value:Ae,label:be}),de},{}))!==null&&fe!==void 0?fe:{},Ne=[].concat(a()(Me),a()(Object.entries(Ue).map(function(de){var Ae=C()(de,2),Se=Ae[0],_e=Ae[1];return{label:Se,options:_e}})));ve(Ne)},[b,T,H]);var ue=(0,E.useCallback)(function(x){var ie;x.file.status==="done"&&N();var fe=(ie=x.file.response)===null||ie===void 0?void 0:ie.name;fe&&g(fe)},[g,N]);return(0,o.jsxs)(o.Fragment,{children:[T==="image"&&(0,o.jsx)(ae.Z.Dragger,{accept:".png, .jpg, .jpeg, .webp",style:{margin:"8px 0"},itemRender:function(){return null},name:"image",action:function(){return(0,P.l9)("/upload/image")},maxCount:1,onChange:ue,children:(0,o.jsxs)(Q.Z,{children:[(0,o.jsx)(se.Z,{}),"Click or drag img to upload"]})}),(0,o.jsx)(z,{showSearch:!0,placeholder:"Search to Select",optionFilterProp:"children",filterOption:function(ie,fe){var Ce;return String((Ce=fe==null?void 0:fe.label)!==null&&Ce!==void 0?Ce:"").toLowerCase().includes(ie.toLowerCase())},style:{width:"100%"},size:"small",value:D,defaultValue:b[0][0],onChange:g,options:Pe})]})},X=E.memo(oe),he=e(7825),ke=e.n(he),je=e(9956),le=["className"],De,Te=(0,V.kc)(function(te){var l=te.stylish,D=te.css,b=te.token;return D(De||(De=m()([`
      `,`

      .`,`-input-number-group-addon {
        padding: 0 4px;
        color: `,`;
        background: `,`;
        border-color: transparent;
      }
    `])),l.controlContainer,_.xb,b.colorTextTertiary,b.colorFillQuaternary)}),we=function(l){var D=l.className,b=ke()(l,le),g=Te(),T=g.styles,F=g.cx;return(0,o.jsx)(k.i,{children:(0,o.jsx)(je.Z,S()(S()({size:"small"},b),{},{className:F(T,D)}))})},We=e(7794),Fe=e(7298),Ge=Fe.ZP.div.withConfig({componentId:"sc-azuxda-0"})(["display:flex;"]),Re=Fe.ZP.div.withConfig({componentId:"sc-azuxda-1"})(["display:flex;flex:",";align-items:center;justify-content:flex-start;> *{width:100%;}"],function(te){var l=te.span;return l}),xe=function(l){var D=l.name,b=l.value,g=l.min,T=l.max,F=l.step,ce=l.style,Pe=l.onChange,ve=(0,A.q)(function(Y){return Y},y.X),W=ve.counter,N=(0,E.useState)(b),H=C()(N,2),ue=H[0],x=H[1],ie=(0,E.useState)(!1),fe=C()(ie,2),Ce=fe[0],Ie=fe[1],Me=D==="seed",Ue=(0,E.useMemo)(function(){var Y=T,be=g,He=F;switch(D){case"steps":T=200;break;case"cfg":T=32,F=.5;break;case"width":T=4096,g=512,F=4;break;case"height":T=4096,g=512,F=4;break;default:break}return{iMax:Y,iMin:be,iStep:He}},[D,T,g,F]),Ne=Ue.iMax,de=Ue.iMin,Ae=Ue.iStep,Se=(0,E.useCallback)(function(Y){var be,He=Number(Y!=null&&(be=Y.target)!==null&&be!==void 0&&be.value?Y.target.value:Y);isNaN(He)||(x(He),Pe(He))},[Pe]),_e=(0,E.useCallback)(function(Y){Ie(Y.target.checked)},[]);return(0,E.useEffect)(function(){!Me||!Ce||Se(Math.floor(Math.random()*Ne))},[W,Ne]),(0,o.jsxs)(Ge,{style:ce,children:[(0,o.jsx)(Re,{span:Me?12:4,style:{marginRight:12},children:(0,o.jsx)(we,{style:{width:"100%"},min:de,max:Ne,step:Ae,value:Number(ue),onBlur:Se,onPressEnter:Se})}),(0,o.jsx)(Re,{span:Me?4:12,children:Me?(0,o.jsx)(n.Z,{checked:Ce,onChange:_e,children:"Random"}):(0,o.jsx)(We.Z,{min:de,max:Ne,onChange:Se,value:Number(ue),step:Ae})})]})},Le=E.memo(xe),Be=function(l){var D=l.id,b=l.name,g=l.input,T=(0,A.q)(function(ve){var W;return{value:(W=ve.graph[D])===null||W===void 0?void 0:W.fields[b],onChange:(0,t.Z)(function(N){var H;return ve.onPropChange(D,b,N!=null&&(H=N.target)!==null&&H!==void 0&&H.value?N.target.value:N)},100)}},y.X),F=T.value,ce=T.onChange;if(v.l.isList(g))return(0,o.jsx)(X,{value:F,name:b,input:g,onChange:ce});if(v.l.isBool(g))return(0,o.jsx)(n.Z,{value:F,defaultChecked:g[1].default,onChange:ce});if(v.l.isInt(g))return(0,o.jsx)(Le,{name:b.toLowerCase(),style:{width:"100%"},value:Number(F!==null?F:g[1].default),max:Number(g[1].max),min:Number(g[1].min),onChange:function(W){var N;return ce(Number(W!=null&&(N=W.target)!==null&&N!==void 0&&N.value?W.target.value:W))}});if(v.l.isFloat(g))return(0,o.jsx)(Le,{name:b.toLowerCase(),style:{width:"100%"},step:.01,value:Number(F!==null?F:g[1].default),max:Number(g[1].max),min:Number(g[1].min),onChange:function(W){var N;return ce(Number(W!=null&&(N=W.target)!==null&&N!==void 0&&N.value?W.target.value:W))}});if(v.l.isString(g)){var Pe=g[1];return Pe.multiline===!0?(0,o.jsx)(U.K,{style:{height:128,width:"100%"},defaultValue:F,onBlur:ce}):(0,o.jsx)(U.I,{style:{width:"100%"},value:F,onChange:ce})}return null},Je=E.memo(Be),Ve=function(l){var D=l.data,b=l.nodeId;return D!=null&&D.length?(0,o.jsx)("div",{onClick:function(T){return T.stopPropagation()},children:D.map(function(g){var T=g.name,F=g.type,ce=g.input;return(0,o.jsxs)("div",{children:[(0,o.jsx)(Ee,{slotType:F,label:T,type:"target",position:ne.Ly.Left,isRequired:!1}),(0,o.jsx)(Je,{name:T,id:b,input:ce}),(0,o.jsx)("div",{style:{height:4}})]},T)})}):null},Ke=E.memo(Ve),ze=function(l){var D=l.id,b=l.data,g=b.input,T=b.output,F=(0,A.q)(function(N){var H;return{imagePreviews:(H=N.graph)===null||H===void 0||(H=H[D])===null||H===void 0||(H=H.images)===null||H===void 0?void 0:H.map(function(ue,x){return{image:ue,index:x}}).filter(Boolean),inputImgPreviews:[{image:{filename:N.onGetNodeFieldsData(D,"image"),type:"input"},index:0}].filter(function(ue){return ue.image.filename})}},y.X),ce=F.imagePreviews,Pe=F.inputImgPreviews,ve=(0,E.useMemo)(function(){var N=[];return Object.entries(g.required).forEach(function(H){var ue=C()(H,2),x=ue[0],ie=ue[1];v.l.isParameterOrList(ie)&&N.push({name:x,type:ie[0],input:ie})}),N},[g]),W=(0,E.useMemo)(function(){var N=[];return Object.entries(g.required).forEach(function(H){var ue=C()(H,2),x=ue[0],ie=ue[1];v.l.isParameterOrList(ie)||N.push({name:x,type:ie[0]})}),N},[g]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(I.VA,{children:[(0,o.jsx)(u,{data:W}),(0,o.jsx)(s,{data:T})]}),(0,o.jsx)(Ke,{data:ve,nodeId:D}),(0,o.jsx)(O,{data:ce||Pe})]})},Ze=E.memo(ze),Ye="sdNode",Qe=function(l){var D;console.log("NodeComponent",l.data.name);var b=(0,E.useRef)(null),g=(0,A.q)(function(_e){var Y;return S()(S()({},_e),{},{progressBar:((Y=_e.nodeInProgress)===null||Y===void 0?void 0:Y.id)===l.id?_e.nodeInProgress.progress:void 0})},y.X),T=g.progressBar,F=g.onDuplicateNode,ce=g.onDeleteNode,Pe=g.onModifyChange,ve=(0,V.Fg)(),W=(0,E.useState)(!1),N=C()(W,2),H=N[0],ue=N[1],x=T!==void 0,ie=l.selected,fe=((D=l.data)===null||D===void 0?void 0:D.nickname)||l.data.name,Ce=l.data.name==="Group",Ie=function(Y){var be=Y.target.value;Pe(l.id,"nickname",be),ue(!1)},Me=function(Y){var be=Y.key;Pe(l.id,"color",q[be])},Ue=[{icon:(0,o.jsx)(i.Z,{}),label:"Rename",key:"rename",onClick:function(){return ue(!0)}},{icon:(0,o.jsx)(me.Z,{}),label:"Colors",key:"colors",children:c,onClick:Me},{type:"divider"},{icon:(0,o.jsx)(w.Z,{}),label:"Copy",key:"copy",onClick:function(){return F(l.id)}},{icon:(0,o.jsx)(pe.Z,{}),label:"Delete",key:"delete",onClick:function(){return ce(l.id)}}],Ne=Ce?I.MW:I.OE,de;if(Ce){var Ae;de=(Ae=l.data)!==null&&Ae!==void 0&&Ae.color?(0,ee.m4)(l.data.color,.2):ve.colorFill}else{var Se;de=(Se=l.data)!==null&&Se!==void 0&&Se.color?(0,ee.CD)(.8,ve.colorBgContainer,l.data.color):ve.colorBgContainer}return(0,E.useEffect)(function(){var _e,Y=(_e=b.current)===null||_e===void 0?void 0:_e.parentNode;Y.setAttribute("type",l.data.name),b.current.setAttribute("type",l.data.name)},[]),(0,o.jsxs)(Ne,{ref:b,size:"small",style:{background:de},title:H?(0,o.jsx)(U.I,{autoFocus:!0,defaultValue:fe,onPressEnter:Ie,onBlur:Ie,size:"small",style:{margin:"4px 0",width:"100%"}}):fe,active:x||ie?1:0,hoverable:!Ce,extra:x?T>0&&(0,o.jsx)(J.Z,{steps:4,percent:Math.floor(T*100)}):(0,o.jsx)(o.Fragment,{}),children:[(0,o.jsx)(Ze,S()({},l)),ie&&(0,o.jsx)(R.KP,{minWidth:80,minHeight:40})]})},Xe=E.memo(Qe)},262:function(ye,G,e){e.d(G,{MW:function(){return S},OE:function(){return $},VA:function(){return q},g7:function(){return U},zw:function(){return o}});var B=e(7380),C=e(7298),$=(0,C.ZP)(B.Z).withConfig({componentId:"sc-35fyyr-0"})(["min-width:80px;min-height:40px;box-shadow:",";",";.ant-card-head{height:15px;padding-right:3px;background:"," !important;border-bottom:unset;}"],function(c){var A=c.theme;return A.boxShadowTertiary},function(c){var A=c.active,i=c.theme;return A?(0,C.iv)(["outline:2px solid ",";"],i.colorPrimary):""},function(c){var A=c.theme;return A.colorFillQuaternary}),S=(0,C.ZP)(B.Z).withConfig({componentId:"sc-35fyyr-1"})(["min-width:80px;height:100%;min-height:120px;",";.react-flow__resize-control{pointer-events:all !important;}.ant-card-head{pointer-events:all !important;height:15px;padding-right:3px;background:"," !important;border-bottom:unset;}"],function(c){var A=c.active,i=c.theme;return A?(0,C.iv)(["outline:2px solid ",";"],i.colorPrimary):""},function(c){var A=c.theme;return A.colorFillQuaternary}),U=C.ZP.div.withConfig({componentId:"sc-35fyyr-2"})(["text-align:",";.react-flow__handle{top:unset;margin-top:10px;background:",";}"],function(c){var A=c.$position;return A},function(c){var A=c.$isRequired,i=c.theme;return A?i.colorPrimary:i.colorBorder}),o=C.ZP.div.withConfig({componentId:"sc-35fyyr-3"})(["flex:1;"]),q=C.ZP.div.withConfig({componentId:"sc-35fyyr-4"})(["display:flex;align-items:stretch;justify-content:stretch;width:100%;"])},520:function(ye,G,e){e.d(G,{k2:function(){return C},xb:function(){return B},z2:function(){return $}});var B="antd";function C(S,U){return U||(S?"".concat(B,"-").concat(S):B)}var $="data:image/webp;base64,UklGRnwFAABXRUJQVlA4WAoAAAAAAAAA/wEA/wEAVlA4IAgFAABQSACdASoAAgACAAAAJaW7hd2Eb84fxL/Fu2b+3YoPsf85/K75gdgO0n/cPKfeDJcf6jjA7zHCYHQ/3j/dfc97KfnX/r+4J/Mv6V/zesX+2XsH/p8mnzJ402iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iY02iBvOWQB3qAPUMTgyeNNomNNomNNo/WuFENRaRU20KzdBk8abRMabRMabZptNKNjzbhNu1hd33Bk8abRMabRMaqb/Kw49SfJ6z/CJMabRMabRMabZmhIYfVFsmHjNZuDy16fMnjTaJjVTjPW0tTJZLHerBQmq0eatO2jHzJ402iY05WHL7+aif7qE1/IHlqJjp8yeNNomNNomOgT5lutenzJ402iY02iiNGPr6y16fMnjTaJjTV4XIBX7qr95uFey16fMnjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJjTaJh4AD+/+LjAAAAAAAAAAAC0rN37fkv7KNTSn+uqCrzce+ZFY+V2wLrwyvKnVnbWsbOXsdMkV78wpw6M5Ht0icrihssgqb5WJa130AMfeLeJ9cO1J09zwdzkLrF52YniIAf5by1ZJR0mRk5V3PL+ibKQy+xwP5TV+T4ump0K+LkZ+wBab78G4GSS/dSUn/muJIrSr1FKYQ2z+Oo/1cghL9BNsO6vmEYog/O+yhpCY29bMR0CXQYvzdg1F/tafnPHYkanS7zfqAUdz9T3liqmBomByf/0xab8CFnMjcUb+WakMeqRZmABEgjvkA0mKYwg38SWQh7/Vuo//EecvnIIU6s8PM/JtA563guvz/n96OwlyoBcJalNQg6XtTNvSAsoHYSMKv/MVt4tAew6OEoZPM7F0GglgJvJ9GZ1dQk/25kMpL351DoZAQ6rfvOizEs4ZuRe6hf/3HsGMMDbaPof/2ceBdX1Le/n4LtHkSExFcCQWXa/vLxe8xfHzvCfoWEH90DfhRSroCMjPo6VU/HbZqBX+ofhRw7+ZbW0v+jwjr24CaaKw0kd2zmn/hhn8Rqx/uUN9yZMB/pn3Bc8ThOFm7xZychuV93W7Q4q7IUHOFjTr3n4JuG+vn47m+DBSGXJL2jhcl0WB0cgW7Yw6xTQgWSBdJ67I/u/AKgIJTyPm2HzqrEx2sT5jp3uoehUB2ASMh4KwpBwVcIjeGYJ+/ICdC2AhxQiD5Rg7H2q+ggI00qhr0tQF9qrx2dAY2PwDASTq8cVMBwYpcMGadEMF7lQWxQv8sZ3YnQu0hWYSk6UE74i2ZSOL+0U4uWD5aUD92da9jCSaecnVKDk2U+mSLuEAAHPkRqknB/sBsy8YFWtSs0TSucCwKYBFVkOe0PikbUHR8/KX9OXKmcZgZDi4+9Phq53iAupQAAAAAAAAAAAAAAUFNBSU4AAAA4QklNA+0AAAAAABAASAAAAAEAAgBIAAAAAQACOEJJTQQoAAAAAAAMAAAAAj/wAAAAAAAAOEJJTQRDAAAAAAAOUGJlVwEQAAYAZAAAAAA="},1326:function(ye,G){var e={host:"localhost:8188",protocol:"http:"},B={host:"localhost:8188",protocol:"http:"},C=e;G.Z=C},858:function(ye,G){var e={data:{"d6488046-7e3d-45ce-b0cb-fc461ded790d":{value:{widget:"VAELoader",fields:{vae_name:"[\u9AD8\u9971\u548C] vae-ft-mse-840000.safetensors"}},position:{x:320,y:1219.5},width:319,height:120},"196c7067-dd8c-4b21-95bf-c7da1074359f":{value:{widget:"Group",fields:{},modify:{nickname:"Prompt"}},position:{x:320.6155722066724,y:1360.4647275134319},width:319,height:539},"2e19ea7c-a469-4aee-ba5f-50546f7b6856":{value:{widget:"PreviewImage",fields:{},images:[{filename:"ComfyUI_00015_.png",subfolder:"",type:"temp"}]},position:{x:959.9330329915367,y:1040.5498613443042},width:535,height:574},"2d69027b-18cb-4fba-a6f7-3cc6191da27a":{value:{widget:"EmptyLatentImage",fields:{width:512,height:512,batch_size:1}},position:{x:680,y:1040},width:240,height:246},"df10802c-dcb3-45cb-b61a-ed21c9435e54":{value:{widget:"VAEDecode",fields:{}},position:{x:680,y:1780},width:240,height:96},"3ab52db7-7835-409b-9742-cdbb84283789":{value:{widget:"KSampler",fields:{seed:0xb8ce6f395b97b000,steps:24,cfg:8,sampler_name:"dpm_2",scheduler:"normal",denoise:.99}},position:{x:680,y:1300},width:240,height:461},"03e009af-40ce-40f8-8678-ee811fe31f41":{value:{widget:"CLIPTextEncode",fields:{text:"bad had"},modify:{color:"#f5222d",nickname:"Negative"}},position:{x:19.384427793327575,y:280.91726159315385},width:280,height:228,parentId:"196c7067-dd8c-4b21-95bf-c7da1074359f"},"18d73b78-7fd7-4411-a39e-b8a17e677892":{value:{widget:"CLIPTextEncode",fields:{text:"beautiful mountain scenery"},modify:{color:"#52c41a",nickname:"Positive"}},position:{x:20,y:40.91726159315385},width:278,height:154,parentId:"196c7067-dd8c-4b21-95bf-c7da1074359f"},"1ab1ba4a-5dfb-4ced-bc06-2b55af930969":{value:{widget:"CheckpointLoaderSimple",fields:{ckpt_name:"CmShota\\CmShotaMix-Unreal.safetensors"},modify:{color:"#fadb14"}},position:{x:321.49999999999994,y:1041},width:317,height:148}},connections:[{source:"1ab1ba4a-5dfb-4ced-bc06-2b55af930969",sourceHandle:"MODEL",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"model"},{source:"1ab1ba4a-5dfb-4ced-bc06-2b55af930969",sourceHandle:"CLIP",target:"18d73b78-7fd7-4411-a39e-b8a17e677892",targetHandle:"clip"},{source:"1ab1ba4a-5dfb-4ced-bc06-2b55af930969",sourceHandle:"CLIP",target:"03e009af-40ce-40f8-8678-ee811fe31f41",targetHandle:"clip"},{source:"03e009af-40ce-40f8-8678-ee811fe31f41",sourceHandle:"CONDITIONING",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"negative"},{source:"18d73b78-7fd7-4411-a39e-b8a17e677892",sourceHandle:"CONDITIONING",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"positive"},{source:"2d69027b-18cb-4fba-a6f7-3cc6191da27a",sourceHandle:"LATENT",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"latent_image"},{source:"3ab52db7-7835-409b-9742-cdbb84283789",sourceHandle:"LATENT",target:"df10802c-dcb3-45cb-b61a-ed21c9435e54",targetHandle:"samples"},{source:"df10802c-dcb3-45cb-b61a-ed21c9435e54",sourceHandle:"IMAGE",target:"2e19ea7c-a469-4aee-ba5f-50546f7b6856",targetHandle:"images"},{source:"d6488046-7e3d-45ce-b0cb-fc461ded790d",sourceHandle:"VAE",target:"df10802c-dcb3-45cb-b61a-ed21c9435e54",targetHandle:"vae"}]};G.Z=e},5910:function(ye,G,e){e.d(G,{q:function(){return Oe}});var B=e(8305),C=e.n(B),$=e(2092),S=e.n($),U=e(5558),o=e.n(U),q=e(228),c=e.n(q),A=e(6068),i=e.n(A),me=e(7999),w=e.n(me),pe=e(1794),J=e(3406),V=e(5180),ee=e(7971),E=function(d){return d.class_type==="CLIPTextEncode"&&d.inputs.text!==void 0},R=function(d){return E(d)?[d.inputs.text]:[]},y=function(d,s){return d[3].client_id===s},I=function(){var u=w()(c()().mark(function d(s){var n;return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,pe.wo)();case 2:return n=r.sent,r.abrupt("return",n.queue_running.concat(n.queue_pending).filter(function(a){return y(a,s)}).map(function(a){var p,m=a[1],h=a[2],k=Object.values(h),M=k.flatMap(R),j=k.find(function(se){return se.class_type.startsWith("CheckpointLoader")}),z=j==null||(p=j.inputs)===null||p===void 0?void 0:p.ckpt_name;return{id:m,prompts:M,model:z}}));case 4:case"end":return r.stop()}},d)}));return function(s){return u.apply(this,arguments)}}(),v=e(7174),_=e(4565),P=function(){var u=w()(c()().mark(function d(){var s,n,t,r,a=arguments;return c()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:s=a.length>0&&a[0]!==void 0?a[0]:5e3,n=a.length>1&&a[1]!==void 0?a[1]:10,t=0;case 3:if(!(t<n)){m.next=21;break}return m.prev=4,m.next=7,v.Z.get((0,_.l9)("/history/123"));case 7:if(r=m.sent,r.status!==200){m.next=11;break}return console.log("Server is back online."),m.abrupt("return",!0);case 11:m.next=16;break;case 13:m.prev=13,m.t0=m.catch(4),console.log("Attempt ".concat(t+1,": Server still restarting..."));case 16:return t++,m.next=19,new Promise(function(h){return setTimeout(h,s)});case 19:m.next=3;break;case 21:return console.error("Server restart check timed out."),m.abrupt("return",!1);case 23:case"end":return m.stop()}},d,null,[[4,13]])}));return function(){return u.apply(this,arguments)}}(),f=function(){var u=w()(c()().mark(function d(){var s,n;return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,v.Z.get((0,_.l9)("/manager/reboot"),{headers:{"Content-Type":"application/json"}});case 3:if(s=r.sent,s.status!==200){r.next=10;break}return console.log("Reboot request sent. Checking server status..."),r.next=8,P(5e3,30);case 8:n=r.sent,console.log(n?"Server restart complete!":"Server did not come back online within the expected time.");case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),console.error("Error sending reboot request:",r.t0);case 15:case"end":return r.stop()}},d,null,[[0,12]])}));return function(){return u.apply(this,arguments)}}(),L=e(2508),K=e(4155),O=e(8826),ne=e(9951),re=e(1825),Z={Group:{input:{required:{}},output:[],output_name:[],name:"Group",category:"Utils"},Reroute:{input:{required:S()({},"*",["*"])},output:["*"],output_name:[],name:"Reroute",category:"Utils"}},ge=Z,Ee=e(8200),Oe=(0,ne.F)()((0,re.mW)(function(u,d){return{messages:[{content:[{text:"Welcome! I'm ready to help you reach out to desired workflows."}],sender:"bot"}],page:"flow",counter:0,widgets:{},customWidgets:Object.keys(ge),graph:{},nodes:[],edges:[],queue:[],gallery:[],themeMode:"auto",edgeType:"default",nodeInProgress:void 0,promptError:void 0,clientId:void 0,onSetPage:function(n){u({page:n},!1,"onSetPage")},onSetThemeMode:function(n){u({themeMode:n},!1,"onSetThemeMode")},onNewClientId:function(n){u({clientId:n},!1,"onNewClientId")},onRefresh:function(){var s=w()(c()().mark(function t(){var r;return c()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,(0,pe.aU)();case 2:r=p.sent,u({widgets:i()(i()({},ge),r)},!1,"onRefresh");case 4:case"end":return p.stop()}},t)}));function n(){return s.apply(this,arguments)}return n}(),onInit:function(){var s=w()(c()().mark(function t(){var r,a;return c()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return setInterval(function(){return d().onPersistTemp()},5e3),m.next=3,(0,pe.aU)();case 3:a=m.sent,u({widgets:i()(i()({},ge),a)},!1,"onInit"),d().onLoadWorkflow((r=(0,J.Vj)())!==null&&r!==void 0?r:{data:{},connections:[]});case 6:case"end":return m.stop()}},t)}));function n(){return s.apply(this,arguments)}return n}(),onAddMessage:function(n){u(function(t){return{messages:[].concat(o()(t.messages),[n])}},!1,"onAddMessage")},onCreateGroup:function(){var n=d(),t=n.nodes,r=n.onDetachGroup,a=t.filter(function(j){return j.selected}).map(function(j){return r(j)});if(!(a.length<1)){var p=1/0,m=0,h=1/0,k=0;a.forEach(function(j){var z=j.position,se=z.x,ae=z.y,Q=j.width,oe=j.height;p=Math.min(p,se),m=Math.max(m,se+Number(Q)),h=Math.min(h,ae),k=Math.max(k,ae+Number(oe))});var M={widget:ge.Group,position:{x:p-40,y:h-60},width:m-p+80,height:k-h+100,key:(0,K.Z)()};u(function(j){return(0,V.gz)(j,M)},!1,"onCreateGroup")}},onSetNodesGroup:function(n,t){u(function(r){return{nodes:r.nodes.map(function(a){if(n.includes(a.id)){if(a.parentId===t.id)return a;a.parentId=t.id,a.position.x=a.position.x-t.position.x,a.position.y=a.position.y-t.position.y}else a.parentId===t.id&&(a.parentId=void 0,a.position.x=a.position.x+t.position.x,a.position.y=a.position.y+t.position.y);return a})}})},onDetachGroup:function(n){if(!n.parentId)return n;var t=d().nodes,r=t.find(function(a){return a.id===n.parentId});return i()(i()({},n),{},{parentId:void 0,position:{x:n.position.x+Number(r==null?void 0:r.position.x),y:n.position.y+Number(r==null?void 0:r.position.y)}})},onDetachNodesGroup:function(n,t){u(function(r){return{nodes:r.nodes.map(function(a){return n.includes(a.id)&&(a.parentId=void 0,a.position.x=a.position.x+t.position.x,a.position.y=a.position.y+t.position.y),a})}})},onNodesChange:function(n){u(function(t){return{nodes:(0,L.Fb)(n,t.nodes)}},!1,"onNodesChange")},onUpdateNodes:function(n,t){u(function(r){return{nodes:(0,V.tV)(n,t,r.nodes)}},!1,"onUpdateNodes")},onAddNode:function(n){u(function(t){return(0,V.gz)(t,n)},!1,"onAddNode")},onDeleteNode:function(n){var t=d().nodes,r=t.find(function(p){return p.id===n}),a=t.filter(function(p){return p.parentId===n}).map(function(p){return p.id});d().onDetachNodesGroup(a,r),u(function(p){return{nodes:(0,L.Fb)([{type:"remove",id:n}],p.nodes)}},!1,"onDeleteNode")},onDuplicateNode:function(n){u(function(t){var r=t.graph,a=t.nodes,p=t.widgets,m=r[n],h=a.find(function(z){return z.id===n}),k=h==null?void 0:h.position,M=k?i()(i()({},k),{},{y:k.y+(h.height||100)+24}):void 0,j=i()(i()({widget:p[m.widget],node:m,position:M},(h==null?void 0:h.width)&&{width:h.width}),(h==null?void 0:h.height)&&{height:h.height});return(0,V.gz)(t,j)},!1,"onDuplicateNode")},onNodeInProgress:function(n,t){u({nodeInProgress:{id:n,progress:t}},!1,"onNodeInProgress")},onPropChange:function(n,t,r){u(function(a){var p;a.onUpdateNodes(n,S()({},t,r));var m=i()(i()({},(p=a.graph[n])===null||p===void 0?void 0:p.fields),{},S()({},t,r)),h=i()(i()({},a.graph[n]),{},{fields:m}),k=i()(i()({},a.graph),{},S()({},n,h));return i()(i()({},a),{},{graph:k})},!1,"onPropChange")},onModifyChange:function(n,t,r){u(function(a){var p;a.onUpdateNodes(n,S()({},t,r));var m=i()(i()({},(p=a.graph[n])===null||p===void 0?void 0:p.modify),{},S()({},t,r)),h=i()(i()({},a.graph[n]),{},{modify:m}),k=i()(i()({},a.graph),{},S()({},n,h));return i()(i()({},a),{},{graph:k})},!1,"onModifyChange")},onGetNodeFieldsData:function(n,t){try{var r;return(r=d())===null||r===void 0||(r=r.graph[n])===null||r===void 0?void 0:r.fields[t]}catch(a){console.error(a)}},onCopyNode:function(){var n=d().nodes,t=n.filter(function(p){return p.selected}).map(function(p){return p.id}),r=(0,J.Mg)(d()),a={};return t.forEach(function(p){var m=r.data[p];if(m.parentId){var h=n.find(function(k){return k.id===m.parentId});a[p]=i()(i()({},m),{},{parentId:void 0,position:{x:m.position.x+Number(h==null?void 0:h.position.x),y:m.position.y+Number(h==null?void 0:h.position.y)}})}else a[p]=m}),r.data=a,r.connections=r.connections.filter(function(p){return t.includes(p.target)&&t.includes(p.source)}),r},onPasteNode:function(n,t){var r=(0,V.ug)(Object.values(n.data).map(function(M){return M.position})),a=(0,V.Xl)(n,r,t),p=a.data,m=a.idMap,h=(0,V.$V)(n,m),k=i()({data:p},h);u(function(M){return Object.entries(k.data).reduce(function(j,z){var se=C()(z,2),ae=se[0],Q=se[1],oe=j.widgets[Q.value.widget];return oe?(0,V.gz)(j,{widget:oe,node:Q.value,position:Q.position,width:Q.width,height:Q.height,parentId:Q.parentId,key:ae}):(console.warn("Unknown widget ".concat(Q.value.widget)),j)},h.connections.reduce(ee.H,M))},!0,"onPasteNode")},onEdgesChange:function(n){u({edges:(0,L.yn)(n,d().edges)},!1,"onEdgesChange")},onEdgesAnimate:function(n){u(function(t){return{edges:t.edges.map(function(r){return i()(i()({},r),{},{animated:n})})}},!1,"onEdgesAnimate")},onEdgesType:function(n){u(function(t){return{edges:t.edges.map(function(r){return i()(i()({},r),{},{type:n})})}},!1,"onEdgesType")},onConnect:function(n){u(function(t){return(0,ee.H)(t,n)},!1,"onConnect")},onImageSave:function(n,t){u(function(r){return{gallery:r.gallery.concat(t.map(function(a){return{image:a}})),graph:i()(i()({},r.graph),{},S()({},n,i()(i()({},r.graph[n]),{},{images:t})))}},!1,"onImageSave")},onSubmit:function(){var s=w()(c()().mark(function t(){var r,a,p;return c()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return r=d(),a=(0,J.Mg)(r),h.next=4,(0,pe.u3)((0,pe.Fh)({graph:a,widgets:r.widgets,customWidgets:r.customWidgets,clientId:r.clientId}));case 4:p=h.sent,u({promptError:p.error,counter:r.counter+1},!1,"onSubmit");case 6:case"end":return h.stop()}},t)}));function n(){return s.apply(this,arguments)}return n}(),onDeleteFromQueue:function(){var s=w()(c()().mark(function t(r){return c()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,(0,pe.bu)(r);case 2:return p.next=4,d().onQueueUpdate();case 4:case"end":return p.stop()}},t)}));function n(t){return s.apply(this,arguments)}return n}(),onQueueUpdate:function(){var s=w()(c()().mark(function t(){return c()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=u,a.next=3,I(d().clientId);case 3:a.t1=a.sent,a.t2={queue:a.t1},(0,a.t0)(a.t2,!1,"onQueueUpdate");case 6:case"end":return a.stop()}},t)}));function n(){return s.apply(this,arguments)}return n}(),onPersistTemp:function(){(0,J.aA)((0,J.Mg)(d()))},onSaveLocalWorkFlow:function(n){(0,J.Eo)((0,J.Mg)(d()),n)},onLoadLocalWorkflow:function(n){var t=(0,J._h)(n);t&&d().onLoadWorkflow(t)},onUpdateLocalWorkFlowGraph:function(n){(0,J.iq)(n,{graph:(0,J.Mg)(d())})},onUpdateLocalWorkFlowTitle:function(n,t){(0,J.iq)(n,{title:t})},onLoadWorkflow:function(){var s=w()(c()().mark(function t(r){var a,p,m;return c()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(u(function(M){return i()(i()({},M),{},{nodes:[],edges:[],counter:0,graph:{}})},!1,"resetBeforeLoad"),!(0,J.TR)(r)){k.next=5;break}u(function(M){var j=M.widgets,z=i()(i()({},M),{},{nodes:[],edges:[],counter:0,graph:{}});return Object.entries(r.data).forEach(function(se){var ae=C()(se,2),Q=ae[0],oe=ae[1],X=j==null?void 0:j[oe.value.widget];X?z=(0,V.gz)(z,{widget:X,node:oe.value,position:oe.position,width:oe.width,height:oe.height,key:Q,parentId:oe.parentId}):console.warn("Unknown widget ".concat(oe.value.widget))}),r.connections.forEach(function(se){z=(0,ee.H)(z,se)}),z},!1,"onLoadWorkflow-basic"),k.next=28;break;case 5:return O.Z.destroyAll(),O.Z.info({content:"Installing nodes, please wait...",centered:!0,footer:null,width:400}),k.next=9,v.Z.post("http://".concat("localhost:8188","/install_node"),{workflow:r},{headers:{"Content-Type":"application/json"}});case 9:if(a=k.sent,a.status===200){k.next=15;break}return O.Z.destroyAll(),O.Z.error({content:"Fail to install node",centered:!0,footer:null,width:400,height:400}),console.error("Failed to install node"),k.abrupt("return");case 15:return a.data.restart===!0&&(O.Z.destroyAll(),O.Z.info({content:"Restarting Server ...",centered:!0,footer:null,width:400,height:400}),f()),k.next=18,P();case 18:if(p=k.sent,p){k.next=24;break}return O.Z.destroyAll(),O.Z.error({content:"Server is not responding",centered:!0,width:400,height:400}),console.error("Server is not responding"),k.abrupt("return");case 24:O.Z.destroyAll(),m=(0,J.Pt)(r,d().widgets),Object.entries(m).forEach(function(M){var j,z=C()(M,2),se=z[0],ae=z[1],Q=(j=d().widgets)===null||j===void 0?void 0:j[ae.class_type];if(Q){var oe={widget:ae.class_type,fields:Object.fromEntries(Object.entries(ae.inputs).filter(function(le){var De=C()(le,2),Te=De[0],we=De[1];return!Array.isArray(we)}))},X=r.nodes.find(function(le){return le.id.toString()===se}),he={x:X?X.pos[0]:0,y:X?X.pos[1]:0},ke=X?X.size[0]:400,je=X?X.size[1]:400;u(function(le){return(0,V.gz)(le,{widget:Q,node:oe,position:he,width:ke,height:je,key:se})},!1,"onLoadWorkflow-addNode-advance")}else console.warn("Unknown widget ".concat(ae.class_type))}),Object.entries(m).forEach(function(M){var j=C()(M,2),z=j[0],se=j[1];Object.entries(se.inputs).forEach(function(ae){var Q=C()(ae,2),oe=Q[0],X=Q[1];if(Array.isArray(X)){var he,ke=oe,je=z,le=X[0],De;if(m[le].class_type==="Reroute"?De="*":De=(he=r.nodes.find(function(Te){return Te.id.toString()===le}).outputs)===null||he===void 0||(he=he[X[1]])===null||he===void 0?void 0:he.type,console.log("Source: ",le,"SourceHandle: ",De,"Target: ",je,"TargetHandle: ",ke),!De){console.warn("No valid source handle for node: ".concat(le,", output index: ").concat(X[1],", skipping connection"));return}u(function(Te){return(0,ee.H)(Te,{source:le,sourceHandle:De,target:je,targetHandle:ke})},!1,"onLoadWorkflow-addConnection-advance")}})});case 28:console.log("step 4");case 29:case"end":return k.stop()}},t)}));function n(t){return s.apply(this,arguments)}return n}(),onDownloadWorkflow:function(){(0,J.Cq)((0,J.Mg)(d()))}}}),Ee.X)},7971:function(ye,G,e){e.d(G,{H:function(){return S},g:function(){return U}});var B=e(6068),C=e.n(B),$=e(1158),S=function(q,c){var A=q.edges,i=c.targetHandle,me=c.target;return C()(C()({},q),{},{edges:(0,$.Z_)(c,A.filter(function(w){return!(w.targetHandle===i&&w.target===me)}))})},U=function(q){return q.edges.flatMap(function(c){var A=c.source,i=c.sourceHandle,me=c.target,w=c.targetHandle;return i!=null&&i.length&&w!==null&&w!==void 0&&w.length?[{source:A,sourceHandle:i,target:me,targetHandle:w}]:[]})}},4565:function(ye,G,e){e.d(G,{l9:function(){return C}});var B=e(1326),C=function(S){return"".concat(B.Z.protocol,"//").concat(B.Z.host).concat(S)}},6952:function(ye,G,e){e.d(G,{l:function(){return q}});var B=e(5298),C=e.n(B),$=e(7069),S=e.n($),U=e(6052),o=function(){function c(){C()(this,c)}return S()(c,[{key:"isBool",value:function(i){return(0,U.Z)(i)?i[0]==="BOOL":!1}},{key:"isInt",value:function(i){return(0,U.Z)(i)?i[0]==="INT":!1}},{key:"isFloat",value:function(i){return(0,U.Z)(i)?i[0]==="FLOAT":!1}},{key:"isString",value:function(i){return(0,U.Z)(i)?i[0]==="STRING":!1}},{key:"isList",value:function(i){return(0,U.Z)(i)?Array.isArray(i[0]):!1}},{key:"isParameterOrList",value:function(i){return(0,U.Z)(i)?this.isBool(i)||this.isInt(i)||this.isFloat(i)||this.isString(i)||this.isList(i):!1}}]),c}(),q=new o},5180:function(ye,G,e){e.d(G,{gz:function(){return pe},$V:function(){return I},Xl:function(){return y},yY:function(){return V},rf:function(){return ee},ug:function(){return E},tV:function(){return J}});var B=e(8305),C=e.n(B),$=e(2092),S=e.n($),U=e(6068),o=e.n(U),q=e(5762),c=e(2508),A=e(4155),i=e(6952),me=function(_){var P={};return Object.entries(_.input.required).forEach(function(f){var L=C()(f,2),K=L[0],O=L[1];if(i.l.isBool(O)){var ne;P[K]=(ne=O[1].default)!==null&&ne!==void 0?ne:!1}else if(i.l.isFloat(O)){var re;P[K]=(re=O[1].default)!==null&&re!==void 0?re:0}else if(i.l.isInt(O)){var Z;P[K]=(Z=O[1].default)!==null&&Z!==void 0?Z:0}else i.l.isString(O)?P[K]="":i.l.isList(O)&&(P[K]=O[0][0])}),P},w=function(_){return{widget:_.name,fields:me(_)}},pe=function(_,P){var f,L=P.widget,K=P.node,O=P.position,ne=O===void 0?{x:0,y:0}:O,re=P.width,Z=P.height,ge=P.key,Ee=P.parentId,Oe=String(ge!=null?ge:(0,A.Z)()),u=_.nodes.map(function(s){var n;return(n=s.zIndex)!==null&&n!==void 0?n:0}).concat([0]).reduce(function(s,n){return Math.max(s,n)})+1,d={id:Oe,type:q.f,data:o()(o()({},L),(f=K==null?void 0:K.modify)!==null&&f!==void 0?f:{}),dragHandle:".ant-card-head",position:ne,zIndex:u,width:re,height:Z,parentId:Ee,style:{width:re,height:Z}};return o()(o()({},_),{},{nodes:(0,c.Fb)([{type:"add",item:d}],_.nodes),graph:o()(o()({},_.graph),{},S()({},Oe,K!=null?K:w(L)))})},J=function(_,P,f){return f.map(function(L){return L.id===_&&(L.data=o()(o()({},L.data),P)),L})},V=function(_,P,f){return f.screenToFlowPosition({x:_,y:P})},ee=function(_,P){var f=P.getViewport(),L=f.x,K=f.y,O=f.zoom,ne=_.current.offsetWidth,re=_.current.offsetHeight;return{x:Math.floor((ne/2-L)/O),y:Math.floor((re/2-K)/O)}},E=function(_){for(var P=_[0],f=1;f<_.length;f++){var L=_[f];(L.x<P.x||L.x===P.x&&L.y<P.y)&&(P=L)}return P},R=function(_,P,f){return o()(o()({},_),{},{position:{x:Math.floor(_.position.x-P.x+f.x),y:Math.floor(_.position.y-P.y+f.y)},key:(0,A.Z)()})},y=function(_,P,f){return Object.entries(_.data).reduce(function(L,K){var O=C()(K,2),ne=O[0],re=O[1],Z=R(re,P,f);return{data:o()(o()({},L.data),{},S()({},Z.key,Z)),idMap:o()(o()({},L.idMap),{},S()({},ne,Z.key))}},{data:{},idMap:{}})},I=function(_,P){return{connections:_.connections.map(function(f){return o()(o()({},f),{},{source:P[f.source],target:P[f.target]})})}}},3406:function(ye,G,e){e.d(G,{Cq:function(){return ne},Eo:function(){return L},Mg:function(){return E},Pt:function(){return Ee},Sf:function(){return f},Sk:function(){return O},TR:function(){return re},Vj:function(){return y},W:function(){return R},_h:function(){return P},aA:function(){return I},iq:function(){return K},qW:function(){return _}});var B=e(8305),C=e.n(B),$=e(335),S=e.n($),U=e(1759),o=e.n(U),q=e(228),c=e.n(q),A=e(7999),i=e.n(A),me=e(6068),w=e.n(me),pe=e(7971),J=e(858),V="kitchen-flow-temp",ee="kitchen-flow-local",E=function(d){var s={};return d.nodes.forEach(function(n){var t=d.graph[n.id];t!==void 0&&(s[n.id]={value:t,position:n.position},n.width&&(s[n.id].width=n.width),n.height&&(s[n.id].height=n.height),n.parentId&&(s[n.id].parentId=n.parentId))}),{data:s,connections:(0,pe.g)(d)}},R=function(){try{localStorage.removeItem(V)}catch(d){console.log("[cleanTempWorkflow]",d)}},y=function(){var d=localStorage.getItem(V);return d?JSON.parse(d):J.Z},I=function(d){try{localStorage.setItem(V,JSON.stringify(d))}catch(s){console.log("[saveTempWorkflow]",s)}},v=function(){try{localStorage.removeItem(ee)}catch(d){console.log("[cleanLocalWorkflows]",d)}},_=function(){try{var d=localStorage.getItem(ee);return d?JSON.parse(d):[]}catch(s){return console.log("[retrieveLocalWorkflows]",s),[]}},P=function(d){var s=_(),n=s.find(function(t){return t.id===d});return n?n.graph:null},f=function(d){try{var s=_().map(function(n){return n.id!==d?n:!1}).filter(Boolean);localStorage.setItem(ee,JSON.stringify(s))}catch(n){console.log("[deleteLocalWorkflowFromId]",n)}},L=function(d,s){try{var n=_(),t=new Date().getTime();n.push({title:s||"Local-".concat(t),time:t,id:"kitchen-".concat(t,"-").concat(Math.floor(Math.random()*1e6)),graph:d}),localStorage.setItem(ee,JSON.stringify(n))}catch(r){console.log("[saveLocalWorkflow]",r)}},K=function(d,s){try{var n=_().map(function(t){return t.id!==d?t:w()(w()(w()({},t),s),{},{time:new Date().getTime()})});localStorage.setItem(ee,JSON.stringify(n))}catch(t){console.log("[updateLocalWorkflow]",t)}},O=function(){var u=i()(c()().mark(function d(s,n){var t,r;return c()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(p.prev=0,t=new FileReader,!s){p.next=9;break}return t.readAsText(s),p.next=6,new Promise(function(m,h){t.addEventListener("load",function(k){var M,j=(M=k.target)===null||M===void 0?void 0:M.result;typeof j=="string"?m(j):h(new Error("Failed to read file"))}),t.addEventListener("error",function(){h(new Error("Error reading file"))})});case 6:return r=p.sent,p.next=9,n(JSON.parse(r));case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(0),console.log("[readWorkflowFromFile]",p.t0);case 14:case"end":return p.stop()}},d,null,[[0,11]])}));return function(s,n){return u.apply(this,arguments)}}(),ne=function(d,s){var n=new Blob([JSON.stringify(d)],{type:"application/json"}),t=URL.createObjectURL(n),r=document.createElement("a");r.download=s?"".concat(s,".json"):"workflow.json",r.href=t,r.click(),URL.revokeObjectURL(t)},re=function(d){return d!==null&&o()(d)==="object"&&"data"in d&&"connections"in d&&o()(d.data)==="object"&&Array.isArray(d.connections)},Z=["fixed","increment","decrement","randomize"],ge=function(d,s){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(s==="Note")return{note:["STRING"]};var t=d[s];if(!t)return null;if(n)return t[n]||null;var r=t.input;return w()(w()({},r.required),r.optional)},Ee=function(d,s){var n=d.version,t=d.nodes,r=d.links;if(!(n&&t&&r))return d;if(!s)throw new Error("An active ComfyUI connection is required to convert a UI workflow file.");var a={},p=S()(t),m;try{for(p.s();!(m=p.n()).done;){var h=m.value;h.type==="PrimitiveNode"&&(a[h.id]=h.widgets_values[0])}}catch(Re){p.e(Re)}finally{p.f()}var k={},M=S()(t),j;try{for(M.s();!(j=M.n()).done;){var z=j.value,se=z.id,ae=z.type;if(ae!=="PrimitiveNode"){var Q={},oe=ge(s,ae);if(!oe)throw new Error("Workflow uses node type ".concat(ae,", but it is not installed on the ComfyUI server."));for(var X=0,he=0,ke=Object.entries(oe);he<ke.length;he++){var je=C()(ke[he],2),le=je[0],De=je[1],Te=De[0];if(["INT","FLOAT","BOOL","STRING"].includes(Te)||Array.isArray(Te)){var we=z.widgets_values;Q[le]=we[X],X+=1,we.length>X&&Z.includes(we[X])&&(X+=1)}var We=S()(z.inputs||[]),Fe;try{var Ge=function(){var xe=Fe.value;if(xe.name===le&&xe.link!==null||xe.name===""&&le==="*"){var Le=r.find(function(Je){return Je[0]===xe.link});if(Le){var Be=a[Le[1]];Be!==void 0?Q[le]=Be:Q[le]=[String(Le[1]),Le[2]]}return 1}};for(We.s();!(Fe=We.n()).done&&!Ge(););}catch(Re){We.e(Re)}finally{We.f()}}k[se]={class_type:ae,inputs:Q}}}}catch(Re){M.e(Re)}finally{M.f()}return k},Oe=function(d,s){var n=d.version,t=d.nodes,r=d.links;if(!(n&&t&&r))return d;if(!s)throw new Error("An active ComfyUI connection is required to convert a UI workflow file.");var a=[],p=_createForOfIteratorHelper(t),m;try{for(p.s();!(m=p.n()).done;){var h=m.value,k=h.id,M=h.type;M!=="PrimitiveNode"&&(s[M]||a.push(M))}}catch(j){p.e(j)}finally{p.f()}return a}}}]);
